<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª - Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø±</title>
    <link rel="icon" href="Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø±.webp" type="image/png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #0a3d2f;
            --primary: #16a085;
            --primary-light: #1abc9c;
            --secondary: #27ae60;
            --accent: #2ecc71;
            --glass: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.25);
            --white: #ffffff;
            --text-light: #f0f0f0;
            --shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            --gold: #f39c12;
            --silver: #95a5a6;
            --bronze: #cd7f32;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --info: #3498db;
            --light-bg: #f8f9fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Cairo", sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            animation: float 8s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 4px solid var(--primary);
        }

        .navbar-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .site-title {
            font-size: 1.6em;
            color: var(--primary-dark);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .site-title i {
            color: var(--primary);
            font-size: 1.8em;
        }

        .nav-links {
            display: flex;
            gap: 10px;
        }

        .nav-links a {
            color: var(--primary-dark);
            text-decoration: none;
            font-weight: 600;
            padding: 12px 20px;
            border-radius: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95em;
            position: relative;
            overflow: hidden;
        }

        .nav-links a:hover {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(22, 160, 133, 0.3);
        }
        
        .nav-links a.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            box-shadow: 0 4px 12px rgba(22, 160, 133, 0.4);
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 0;
            height: 3px;
            background: white;
            transition: width 0.3s ease;
        }
        
        .nav-links a.active::after {
            width: 100%;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            border-left: 6px solid var(--primary);
            backdrop-filter: blur(10px);
        }
        
        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }
        
        .page-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(46, 204, 113, 0.1) 0%, transparent 70%);
            z-index: 0;
        }

        .page-header h1 {
            color: var(--primary-dark);
            font-size: 2.8em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            position: relative;
            z-index: 1;
        }
        
        .page-header h1 i {
            color: var(--primary);
            font-size: 1.2em;
        }

        .page-header p {
            color: #555;
            font-size: 1.2em;
            max-width: 800px;
            margin: 0 auto 25px;
            line-height: 1.8;
            position: relative;
            z-index: 1;
        }
        
        .page-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }
        
        .action-btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--light-bg), white);
            border: 2px solid var(--primary);
            border-radius: 12px;
            color: var(--primary-dark);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1em;
            position: relative;
            overflow: hidden;
        }
        
        .action-btn:hover {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border-color: var(--accent);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(22, 160, 133, 0.4);
        }
        
        .action-btn:active {
            transform: translateY(-1px);
        }
        
        .action-btn i {
            font-size: 1.2em;
        }
        
        .action-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.7s;
        }
        
        .action-btn:hover::after {
            left: 100%;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            border-top: 5px solid var(--primary);
            height: 100%;
            backdrop-filter: blur(10px);
        }
        
        .stat-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .stat-card.premium {
            border-top-color: var(--gold);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 248, 225, 0.95));
        }
        
        .stat-card.danger {
            border-top-color: var(--danger);
        }
        
        .stat-card.warning {
            border-top-color: var(--warning);
        }
        
        .stat-card.info {
            border-top-color: var(--info);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .stat-card:hover::before {
            transform: translateX(100%);
        }

        .stat-icon {
            font-size: 3.2em;
            margin-bottom: 20px;
            color: var(--primary);
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }
        
        .stat-card.premium .stat-icon {
            color: var(--gold);
        }
        
        .stat-card.danger .stat-icon {
            color: var(--danger);
        }
        
        .stat-card.warning .stat-icon {
            color: var(--warning);
        }
        
        .stat-card.info .stat-icon {
            color: var(--info);
        }

        .stat-number {
            font-size: 3.2em;
            font-weight: 800;
            color: var(--primary-dark);
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-unit {
            font-size: 0.5em;
            color: #666;
            font-weight: normal;
        }

        .stat-label {
            color: #444;
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .stat-subtext {
            font-size: 1em;
            color: #666;
            margin-top: 10px;
            line-height: 1.6;
            padding: 0 10px;
        }
        
        .progress-container {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.03);
            border-radius: 15px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .progress-bar {
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 6px;
            transition: width 1.5s ease;
        }
        
        .progress-fill.premium {
            background: linear-gradient(90deg, var(--gold), #f1c40f);
        }

        .charts-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
            position: relative;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .charts-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 20px 20px 0 0;
        }

        .section-title {
            color: var(--primary-dark);
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 20px;
            border-bottom: 3px solid rgba(22, 160, 133, 0.2);
        }
        
        .section-title i {
            color: var(--primary);
            font-size: 1.2em;
        }
        
        .section-description {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
            line-height: 1.8;
            background: rgba(248, 249, 250, 0.8);
            padding: 20px;
            border-radius: 12px;
            border-right: 4px solid var(--primary);
        }

        .chart-container {
            margin-bottom: 40px;
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 25px;
            padding: 10px 0;
        }

        .bar-label {
            min-width: 250px;
            font-weight: 600;
            color: #444;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bar-label i {
            color: var(--primary);
            font-size: 1.2em;
        }

        .bar-container {
            flex: 1;
            height: 40px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 20px;
            transition: width 1.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 20px;
            min-width: 50px;
            position: relative;
            overflow: hidden;
        }
        
        .bar-fill.premium {
            background: linear-gradient(90deg, var(--gold), #f1c40f);
        }
        
        .bar-fill.danger {
            background: linear-gradient(90deg, #e74c3c, #e67e22);
        }
        
        .bar-fill.info {
            background: linear-gradient(90deg, #3498db, #2980b9);
        }

        .bar-value {
            color: white;
            font-weight: 800;
            font-size: 1.1em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 1;
        }
        
        .bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent 30%, rgba(255, 255, 255, 0.2) 50%, transparent 70%);
            animation: shimmer 2s infinite;
        }

        .tables-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 50px;
        }
        
        @media (max-width: 1200px) {
            .tables-container {
                grid-template-columns: 1fr;
            }
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-radius: 15px;
            overflow: hidden;
            font-size: 1em;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .data-table th,
        .data-table td {
            padding: 18px 25px;
            text-align: right;
            border-bottom: 1px solid rgba(238, 242, 247, 0.8);
        }

        .data-table th {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            font-weight: 700;
            font-size: 1.1em;
            border-bottom: none;
            position: relative;
        }
        
        .data-table th::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 3px;
            background: var(--accent);
        }

        .data-table tr:hover {
            background: rgba(22, 160, 133, 0.05);
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        .data-table td {
            color: #444;
            transition: all 0.3s ease;
        }
        
        .data-table tr:hover td {
            transform: translateX(-5px);
        }

        .curriculum-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 0.95em;
            font-weight: 700;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        .badge-egypt {
            background: linear-gradient(135deg, #e8f6f3, #a3e4d7);
            color: var(--primary-dark);
            border: 2px solid var(--primary);
        }

        .badge-saudi {
            background: linear-gradient(135deg, #fef9e7, #f8c471);
            color: #d35400;
            border: 2px solid var(--gold);
        }
        
        .duration-badge {
            display: inline-block;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 700;
            background: linear-gradient(135deg, #e8f6f3, #a3e4d7);
            color: var(--primary-dark);
            border: 2px solid var(--primary);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        
        .date-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 700;
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #0d47a1;
            border: 2px solid #2196f3;
        }
        
        .time-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 700;
            background: linear-gradient(135deg, #fff8e1, #ffe082);
            color: #e65100;
            border: 2px solid #ff9800;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            height: 100%;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .table-container h3 {
            color: var(--primary-dark);
            font-size: 1.6em;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 20px;
            border-bottom: 3px solid rgba(22, 160, 133, 0.2);
        }
        
        .table-container h3 i {
            color: var(--primary);
            font-size: 1.2em;
        }
        
        .table-description {
            color: #666;
            margin-bottom: 25px;
            font-size: 1.05em;
            line-height: 1.7;
            background: rgba(248, 249, 250, 0.8);
            padding: 18px;
            border-radius: 12px;
            border-right: 4px solid var(--primary);
        }

        footer {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            text-align: center;
            margin-top: 60px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--primary);
            backdrop-filter: blur(10px);
        }

        footer a {
            color: var(--primary-dark);
            text-decoration: none;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }
        
        footer a:hover {
            color: var(--primary);
            transform: translateY(-2px);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 30px;
            color: #777;
        }
        
        .empty-state i {
            font-size: 4em;
            margin-bottom: 20px;
            color: #ddd;
            opacity: 0.5;
        }
        
        .empty-state p {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #666;
        }
        
        .empty-state .subtext {
            font-size: 1em;
            color: #999;
            max-width: 400px;
            margin: 0 auto;
            line-height: 1.6;
        }

        @media (max-width: 992px) {
            .navbar-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            .page-header h1 {
                font-size: 2.2em;
            }
            
            .page-header {
                padding: 30px 25px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 25px;
            }

            .bar-label {
                min-width: 180px;
                font-size: 1em;
            }
            
            .tables-container {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .data-table {
                font-size: 0.95em;
            }
            
            .data-table th,
            .data-table td {
                padding: 15px 20px;
            }
            
            .section-title {
                font-size: 1.6em;
            }
        }
        
        @media (max-width: 768px) {
            .page-header h1 {
                font-size: 1.8em;
                flex-direction: column;
                gap: 10px;
            }
            
            .page-actions {
                gap: 10px;
            }
            
            .action-btn {
                padding: 12px 20px;
                font-size: 0.9em;
            }
            
            .bar-label {
                min-width: 150px;
                font-size: 0.95em;
            }
        }
        
        /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar {
            width: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 10px;
            border: 3px solid rgba(255, 255, 255, 0.1);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .grade-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 700;
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #0d47a1;
            border: 2px solid #2196f3;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        
        .stats-summary {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding-top: 20px;
            border-top: 2px dashed rgba(22, 160, 133, 0.3);
            font-size: 0.95em;
            color: #666;
        }
        
        .stats-summary div {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stats-summary span:first-child {
            font-weight: 800;
            color: var(--primary-dark);
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        .stats-summary span:last-child {
            color: #666;
            font-size: 0.9em;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø±ØªØ¨ */
        .rank-1 { color: var(--gold); font-weight: 900; }
        .rank-2 { color: var(--silver); font-weight: 800; }
        .rank-3 { color: var(--bronze); font-weight: 800; }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© */
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.4s ease;
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.98));
            border-radius: 25px;
            padding: 40px;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            width: 95%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: slideUp 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            transform: rotate(90deg) scale(1.1);
            background: #c0392b;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙÙ„Ø§ØªØ± */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid #ddd;
            border-radius: 10px;
            color: #555;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(22, 160, 133, 0.3);
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„Ø© */
        .section-collapse {
            cursor: pointer;
            user-select: none;
        }
        
        .section-collapse i {
            transition: transform 0.3s ease;
        }
        
        .section-collapse.collapsed i {
            transform: rotate(-90deg);
        }
        
        .section-content {
            overflow: hidden;
            transition: max-height 0.5s ease, opacity 0.3s ease;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 100px;
            right: 30px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: 700;
            animation: slideIn 0.4s ease, slideOut 0.4s ease 2.6s;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 400px;
            border-left: 5px solid white;
        }
        
        .notification i {
            font-size: 1.5em;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-icon {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-icon.primary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }
        
        .btn-icon.secondary {
            background: rgba(255, 255, 255, 0.9);
            color: var(--primary-dark);
            border: 2px solid var(--primary);
        }
        
        .btn-icon:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ØªÙˆØ§Ø±ÙŠØ® */
        .date-display {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-weight: 600;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
        .icon-badge {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon-badge::after {
            content: attr(data-badge);
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            font-size: 0.7em;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 800;
        }
    </style>
</head>
<body>
    <!-- ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª -->
    <div class="particles" id="particles"></div>
    
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="site-title">
                <i class="fas fa-chart-network"></i>
                <span data-en="Abrar Schools Analytics" data-ar="Ù„ÙˆØ­Ø© ØªØ­Ù„ÙŠÙ„Ø§Øª Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø±">
                    Ù„ÙˆØ­Ø© ØªØ­Ù„ÙŠÙ„Ø§Øª Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø±
                </span>
            </div>
            <div class="nav-links">
                <a href="index.html">
                    <i class="fas fa-home"></i>
                    <span data-en="Home" data-ar="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                </a>
                <a href="statistics.html" class="active">
                    <i class="fas fa-analytics"></i>
                    <span data-en="Analytics" data-ar="Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</span>
                </a>
                <a href="about.html">
                    <i class="fas fa-info-circle"></i>
                    <span data-en="About" data-ar="Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</span>
                </a>
                <a href="contact.html">
                    <i class="fas fa-envelope"></i>
                    <span data-en="Contact" data-ar="Ø§Ù„ØªÙˆØ§ØµÙ„">Ø§Ù„ØªÙˆØ§ØµÙ„</span>
                </a>
                <a href="login.html" id="logoutBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i>
                    <span data-en="Logout" data-ar="ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</span>
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
        <div class="page-header">
            <h1>
                <i class="fas fa-analytics"></i>
                <span data-en="Advanced Analytics Dashboard" data-ar="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©">
                    Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                </span>
            </h1>
            <p data-en="Real-time analytics and insights about platform usage" 
               data-ar="ØªØ­Ù„ÙŠÙ„Ø§Øª ÙÙˆØ±ÙŠØ© ÙˆØ±Ø¤Ù‰ Ø°ÙƒÙŠØ© Ø­ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø± Ø§Ù„Ø£Ù‡Ù„ÙŠØ© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©">
                ØªØ­Ù„ÙŠÙ„Ø§Øª ÙÙˆØ±ÙŠØ© ÙˆØ±Ø¤Ù‰ Ø°ÙƒÙŠØ© Ø­ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø± Ø§Ù„Ø£Ù‡Ù„ÙŠØ© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
            </p>
            <div class="page-actions">
                <button class="action-btn" onclick="refreshStatistics()">
                    <i class="fas fa-sync-alt"></i>
                    <span data-en="Refresh Data" data-ar="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                </button>
                <button class="action-btn" onclick="exportData()">
                    <i class="fas fa-file-export"></i>
                    <span data-en="Export Data" data-ar="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                </button>
                <button class="action-btn" onclick="clearOldData()">
                    <i class="fas fa-trash-restore"></i>
                    <span data-en="Clear Old Data" data-ar="Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©">Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</span>
                </button>
                <button class="action-btn" onclick="showDetailedReport()">
                    <i class="fas fa-file-alt"></i>
                    <span data-en="Detailed Report" data-ar="ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„">ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„</span>
                </button>
                <button class="action-btn" onclick="showSettings()">
                    <i class="fas fa-cog"></i>
                    <span data-en="Settings" data-ar="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                </button>
            </div>
        </div>

        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø© -->
        <div class="charts-section">
            <h2 class="section-title">
                <i class="fas fa-chart-pie"></i>
                <span data-en="General Statistics" data-ar="Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©">
                    Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                </span>
            </h2>
            <p class="section-description">
                <i class="fas fa-info-circle"></i> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ØªØ´Ù…Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª ÙˆÙ…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª. ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ.
            </p>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-number" id="totalLogins">0</div>
                    <div class="stat-label" data-en="Total Logins" data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„">
                        Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </div>
                    <div class="stat-subtext" id="uniqueUsers"></div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Ø§Ù„ÙŠÙˆÙ…</span>
                            <span id="todayLogins">0</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="todayLoginsProgress"></div>
                        </div>
                    </div>
                    <div class="stats-summary">
                        <div>
                            <span id="weeklyLogins">0</span>
                            <span>Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§</span>
                        </div>
                        <div>
                            <span id="monthlyLogins">0</span>
                            <span>Ø´Ù‡Ø±ÙŠÙ‹Ø§</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card premium">
                    <div class="stat-icon">ğŸ“¥</div>
                    <div class="stat-number" id="totalDownloads">0</div>
                    <div class="stat-label" data-en="Total Downloads" data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª">
                        Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
                    </div>
                    <div class="stat-subtext" id="downloadTrend"></div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Ø§Ù„ÙŠÙˆÙ…</span>
                            <span id="todayDownloads">0</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill premium" id="todayDownloadsProgress"></div>
                        </div>
                    </div>
                    <div class="stats-summary">
                        <div>
                            <span id="avgDailyDownloads">0</span>
                            <span>ÙŠÙˆÙ…ÙŠÙ‹Ø§</span>
                        </div>
                        <div>
                            <span id="peakHour">--:--</span>
                            <span>Ø³Ø§Ø¹Ø© Ø§Ù„Ø°Ø±ÙˆØ©</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card info">
                    <div class="stat-icon">â±ï¸</div>
                    <div class="stat-number" id="avgSessionTime">0</div>
                    <div class="stat-unit">Ø¯Ù‚ÙŠÙ‚Ø©</div>
                    <div class="stat-label" data-en="Avg. Session Time" data-ar="Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©">
                        Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
                    </div>
                    <div class="stat-subtext" id="sessionTrend"></div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Ø£Ø·ÙˆÙ„ Ø¬Ù„Ø³Ø©</span>
                            <span id="longestSession">0</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill info" id="sessionDurationProgress"></div>
                        </div>
                    </div>
                    <div class="stats-summary">
                        <div>
                            <span id="totalSessionTime">0</span>
                            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª</span>
                        </div>
                        <div>
                            <span id="shortestSession">0</span>
                            <span>Ø£Ù‚ØµØ± Ø¬Ù„Ø³Ø©</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-icon">ğŸ“š</div>
                    <div class="stat-number" id="totalBooks">0</div>
                    <div class="stat-label" data-en="Available Books" data-ar="Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ØªÙˆÙØ±Ø©">
                        Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ØªÙˆÙØ±Ø©
                    </div>
                    <div class="stat-subtext" id="booksTrend"></div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Ø§Ù„Ù…ØµØ±ÙŠ</span>
                            <span id="egyptBooksCount">0</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill warning" id="egyptBooksProgress"></div>
                        </div>
                    </div>
                    <div class="stats-summary">
                        <div>
                            <span id="saudiBooksCount">0</span>
                            <span>Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ</span>
                        </div>
                        <div>
                            <span id="newBooks">0</span>
                            <span>ÙƒØªØ¨ Ø¬Ø¯ÙŠØ¯Ø©</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ù‚Ø³Ù… Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div class="charts-section">
            <div class="section-title section-collapse" onclick="toggleSection(this)">
                <i class="fas fa-chevron-down"></i>
                <i class="fas fa-history"></i>
                <span data-en="Last 100 Login Records" data-ar="Ø¢Ø®Ø± 100 Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„">
                    Ø¢Ø®Ø± 100 Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
                </span>
            </div>
            <div class="section-description">
                <i class="fas fa-info-circle"></i> Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¢Ø®Ø± 100 Ø¹Ù…Ù„ÙŠØ© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ ÙˆØ§Ù„ÙˆÙ‚Øª. ÙŠØªÙ… ØªØ±ØªÙŠØ¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù….
            </div>
            
            <div class="filters">
                <button class="filter-btn active" onclick="filterTable('all')">
                    <i class="fas fa-filter"></i> Ø§Ù„ÙƒÙ„
                </button>
                <button class="filter-btn" onclick="filterTable('Ù…ØµØ±ÙŠ')">
                    <i class="fas fa-flag"></i> Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…ØµØ±ÙŠ
                </button>
                <button class="filter-btn" onclick="filterTable('Ø³Ø¹ÙˆØ¯ÙŠ')">
                    <i class="fas fa-flag"></i> Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ
                </button>
                <button class="filter-btn" onclick="filterTable('today')">
                    <i class="fas fa-calendar-day"></i> Ø§Ù„ÙŠÙˆÙ…
                </button>
            </div>
            
            <div class="table-container">
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-en="#" data-ar="#">#</th>
                                <th data-en="Student Name" data-ar="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                <th data-en="Grade" data-ar="Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</th>
                                <th data-en="Curriculum" data-ar="Ø§Ù„Ù…Ø³Ø§Ø±">Ø§Ù„Ù…Ø³Ø§Ø±</th>
                                <th data-en="Date" data-ar="Ø§Ù„ØªØ§Ø±ÙŠØ®">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th data-en="Time" data-ar="Ø§Ù„ÙˆÙ‚Øª">Ø§Ù„ÙˆÙ‚Øª</th>
                                <th data-en="Actions" data-ar="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="loginHistoryTable">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                        </tbody>
                    </table>
                    <div id="loginHistoryEmpty" class="empty-state" style="display: none;">
                        <i class="fas fa-clipboard-list"></i>
                        <p data-en="No login records available" data-ar="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¯Ø®ÙˆÙ„ Ù…ØªØ§Ø­Ø©">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¯Ø®ÙˆÙ„ Ù…ØªØ§Ø­Ø©
                        </p>
                        <p class="subtext">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­Ø©</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ù‚Ø³Ù… Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª ÙˆØ§Ù„ÙƒØªØ¨ Ø§Ù„Ø£ÙƒØ«Ø± ØªØ­Ù…ÙŠÙ„Ø§Ù‹ -->
        <div class="tables-container">
            <div class="table-container">
                <h3 class="section-collapse" onclick="toggleSection(this)">
                    <i class="fas fa-chevron-down"></i>
                    <i class="fas fa-clock"></i>
                    <span data-en="Session Duration History" data-ar="Ø³Ø¬Ù„ Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª">
                        Ø³Ø¬Ù„ Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª
                    </span>
                </h3>
                <p class="table-description">
                    <i class="fas fa-info-circle"></i> ØªÙØ§ØµÙŠÙ„ Ù…Ø¯Ø© Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©. ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬.
                </p>
                
                <div class="filters">
                    <button class="filter-btn active" onclick="filterSessions('all')">
                        <i class="fas fa-filter"></i> Ø§Ù„ÙƒÙ„
                    </button>
                    <button class="filter-btn" onclick="filterSessions('long')">
                        <i class="fas fa-hourglass-end"></i> Ø£Ø·ÙˆÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
                    </button>
                    <button class="filter-btn" onclick="filterSessions('short')">
                        <i class="fas fa-hourglass-start"></i> Ø£Ù‚ØµØ± Ø§Ù„Ø¬Ù„Ø³Ø§Øª
                    </button>
                    <button class="filter-btn" onclick="filterSessions('today')">
                        <i class="fas fa-calendar-day"></i> Ø§Ù„ÙŠÙˆÙ…
                    </button>
                </div>
                
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-en="Student Name" data-ar="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                <th data-en="Grade" data-ar="Ø§Ù„ØµÙ">Ø§Ù„ØµÙ</th>
                                <th data-en="Duration" data-ar="Ø§Ù„Ù…Ø¯Ø©">Ø§Ù„Ù…Ø¯Ø©</th>
                                <th data-en="Login Time" data-ar="ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„">ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                                <th data-en="Logout Time" data-ar="ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬">ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th>
                            </tr>
                        </thead>
                        <tbody id="sessionHistoryTable">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                        </tbody>
                    </table>
                    <div id="sessionHistoryEmpty" class="empty-state" style="display: none;">
                        <i class="fas fa-hourglass-half"></i>
                        <p data-en="No session history available" data-ar="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¬Ù„Ø³Ø§Øª Ù…ØªØ§Ø­Ø©">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¬Ù„Ø³Ø§Øª Ù…ØªØ§Ø­Ø©
                        </p>
                        <p class="subtext">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø³Ø¬Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø¨Ø¹Ø¯ Ø£Ù† ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù…Ù†ØµØ©</p>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <h3 class="section-collapse" onclick="toggleSection(this)">
                    <i class="fas fa-chevron-down"></i>
                    <i class="fas fa-book-open"></i>
                    <span data-en="Top 10 Downloaded Books" data-ar="Ø£ÙƒØ«Ø± 10 ÙƒØªØ¨ ØªØ­Ù…ÙŠÙ„Ø§Ù‹">
                        Ø£ÙƒØ«Ø± 10 ÙƒØªØ¨ ØªØ­Ù…ÙŠÙ„Ø§Ù‹
                    </span>
                </h3>
                <p class="table-description">
                    <i class="fas fa-info-circle"></i> Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø£ÙƒØ«Ø± ØªØ­Ù…ÙŠÙ„Ø§Ù‹ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©. ØªØ³Ø§Ø¹Ø¯ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ù‹Ø§.
                </p>
                
                <div class="filters">
                    <button class="filter-btn active" onclick="filterBooks('all')">
                        <i class="fas fa-filter"></i> Ø§Ù„ÙƒÙ„
                    </button>
                    <button class="filter-btn" onclick="filterBooks('Ù…ØµØ±ÙŠ')">
                        <i class="fas fa-flag"></i> Ø§Ù„Ù…ØµØ±ÙŠ
                    </button>
                    <button class="filter-btn" onclick="filterBooks('Ø³Ø¹ÙˆØ¯ÙŠ')">
                        <i class="fas fa-flag"></i> Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ
                    </button>
                    <button class="filter-btn" onclick="filterBooks('month')">
                        <i class="fas fa-calendar-alt"></i> Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±
                    </button>
                </div>
                
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th data-en="#" data-ar="#">#</th>
                                <th data-en="Book Title" data-ar="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨">Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨</th>
                                <th data-en="Curriculum" data-ar="Ø§Ù„Ù…Ø³Ø§Ø±">Ø§Ù„Ù…Ø³Ø§Ø±</th>
                                <th data-en="Downloads" data-ar="Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª">Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª</th>
                                <th data-en="Trend" data-ar="Ø§Ù„ØªÙˆØ¬Ù‡">Ø§Ù„ØªÙˆØ¬Ù‡</th>
                            </tr>
                        </thead>
                        <tbody id="topDownloadsTable">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                        </tbody>
                    </table>
                    <div id="topDownloadsEmpty" class="empty-state" style="display: none;">
                        <i class="fas fa-book"></i>
                        <p data-en="No download data available" data-ar="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­Ù…ÙŠÙ„ Ù…ØªØ§Ø­Ø©">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­Ù…ÙŠÙ„ Ù…ØªØ§Ø­Ø©
                        </p>
                        <p class="subtext">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ Ø£Ù† ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
        <div class="charts-section">
            <h2 class="section-title section-collapse" onclick="toggleSection(this)">
                <i class="fas fa-chevron-down"></i>
                <i class="fas fa-calendar-alt"></i>
                <span data-en="Downloads by Academic Year" data-ar="Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©">
                    Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
                </span>
            </h2>
            <p class="section-description">
                <i class="fas fa-info-circle"></i> ØªÙˆØ²ÙŠØ¹ ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„ÙƒØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø®ØªÙ„ÙØ©. ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ ÙÙ‡Ù… Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©.
            </p>
            <div class="bar-chart" id="yearChart"></div>
        </div>

        <div class="charts-section">
            <h2 class="section-title section-collapse" onclick="toggleSection(this)">
                <i class="fas fa-chevron-down"></i>
                <i class="fas fa-layer-group"></i>
                <span data-en="Downloads by Semester" data-ar="Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ">
                    Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ
                </span>
            </h2>
            <p class="section-description">
                <i class="fas fa-info-circle"></i> Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ. ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ù„ÙƒÙ„ ÙØµÙ„.
            </p>
            <div class="bar-chart" id="termChart"></div>
        </div>

        <div class="charts-section">
            <h2 class="section-title section-collapse" onclick="toggleSection(this)">
                <i class="fas fa-chevron-down"></i>
                <i class="fas fa-book-reader"></i>
                <span data-en="Downloads by Subject" data-ar="Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©">
                    Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
                </span>
            </h2>
            <p class="section-description">
                <i class="fas fa-info-circle"></i> ØªÙˆØ²ÙŠØ¹ ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„ÙƒØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø®ØªÙ„ÙØ©. ÙŠØ¨ÙŠÙ† Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ù‡ØªÙ…Ø§Ù…Ù‹Ø§ Ù„Ø¯Ù‰ Ø§Ù„Ø·Ù„Ø§Ø¨.
            </p>
            <div class="bar-chart" id="subjectChart"></div>
        </div>

        <div class="charts-section">
            <h2 class="section-title section-collapse" onclick="toggleSection(this)">
                <i class="fas fa-chevron-down"></i>
                <i class="fas fa-graduation-cap"></i>
                <span data-en="Downloads by Grade Level" data-ar="Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©">
                    Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
                </span>
            </h2>
            <p class="section-description">
                <i class="fas fa-info-circle"></i> Ù…Ù‚Ø§Ø±Ù†Ø© ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„ÙƒØªØ¨ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø®ØªÙ„ÙØ© (Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©ØŒ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©ØŒ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©).
            </p>
            <div class="bar-chart" id="gradeChart"></div>
        </div>

        <footer>
            <a href="rights.html">
                <i class="fas fa-copyright"></i>
                <span data-en="All Rights Reserved Â© 2025 Abrar Private Schools" 
                      data-ar="Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2025 Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø± Ø§Ù„Ø£Ù‡Ù„ÙŠØ©">
                    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2025 Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø± Ø§Ù„Ø£Ù‡Ù„ÙŠØ© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
                </span>
            </a>
            <div style="margin-top: 15px; color: #666; font-size: 0.95em;">
                <i class="fas fa-database"></i> Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª: <span id="lastUpdateTime"></span> |
                <i class="fas fa-server"></i> Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: <span id="dataSize">0 KB</span> |
                <i class="fas fa-history"></i> Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„: <span id="autoRefresh">60 Ø«Ø§Ù†ÙŠØ©</span>
            </div>
        </footer>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„ -->
    <div id="detailedReportModal" class="modal" style="display: none;">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('detailedReportModal')">âœ•</button>
            <div id="detailedReportContent"></div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('settingsModal')">âœ•</button>
            <h2 style="color: var(--primary-dark); margin-bottom: 25px;">
                <i class="fas fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
            </h2>
            <div style="display: grid; gap: 20px;">
                <div style="background: rgba(248, 249, 250, 0.8); padding: 20px; border-radius: 12px;">
                    <h3 style="color: var(--primary-dark); margin-bottom: 15px;">
                        <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </h3>
                    <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <input type="checkbox" id="autoRefreshToggle" checked>
                        <span>Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                    </label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span>ÙØªØ±Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«:</span>
                        <select id="refreshInterval" style="padding: 8px 15px; border-radius: 8px; border: 2px solid var(--primary);">
                            <option value="30000">30 Ø«Ø§Ù†ÙŠØ©</option>
                            <option value="60000" selected>60 Ø«Ø§Ù†ÙŠØ©</option>
                            <option value="120000">2 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                            <option value="300000">5 Ø¯Ù‚Ø§Ø¦Ù‚</option>
                        </select>
                    </div>
                </div>
                
                <div style="background: rgba(248, 249, 250, 0.8); padding: 20px; border-radius: 12px;">
                    <h3 style="color: var(--primary-dark); margin-bottom: 15px;">
                        <i class="fas fa-filter"></i> Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„Ù…Ø¸Ù‡Ø±
                    </h3>
                    <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <input type="checkbox" id="darkModeToggle">
                        <span>Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="animationsToggle" checked>
                        <span>Ø§Ù„Ø­Ø±ÙƒØ§Øª ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª</span>
                    </label>
                </div>
                
                <div style="background: rgba(248, 249, 250, 0.8); padding: 20px; border-radius: 12px;">
                    <h3 style="color: var(--primary-dark); margin-bottom: 15px;">
                        <i class="fas fa-database"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </h3>
                    <div class="btn-group">
                        <button class="btn-icon primary" onclick="backupData()">
                            <i class="fas fa-save"></i> Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                        </button>
                        <button class="btn-icon secondary" onclick="resetStatistics()">
                            <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                        </button>
                        <button class="btn-icon danger" onclick="clearAllData()">
                            <i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„ÙƒÙ„
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ---------- Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ----------
        let currentLang = localStorage.getItem("siteLang") || "ar";
        let autoRefreshInterval = null;
        let currentFilter = 'all';
        let expandedSections = new Set(['general', 'login', 'sessions', 'books', 'charts']);
        
        // ---------- ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª ----------
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 25;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                const size = Math.random() * 25 + 5;
                const posX = Math.random() * 100;
                const posY = Math.random() * 100;
                const delay = Math.random() * 5;
                const duration = Math.random() * 10 + 5;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${posX}%`;
                particle.style.top = `${posY}%`;
                particle.style.animationDelay = `${delay}s`;
                particle.style.animationDuration = `${duration}s`;
                particle.style.opacity = Math.random() * 0.3 + 0.1;
                particle.style.background = `rgba(255, 255, 255, ${Math.random() * 0.3 + 0.1})`;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // ---------- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚ ----------
        function formatDuration(ms) {
            if (!ms || ms < 1000) return "Ø£Ù‚Ù„ Ù…Ù† Ø«Ø§Ù†ÙŠØ©";
            
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) {
                return `${days} ÙŠÙˆÙ… ${hours % 24} Ø³Ø§Ø¹Ø©`;
            } else if (hours > 0) {
                return `${hours} Ø³Ø§Ø¹Ø© ${minutes % 60} Ø¯Ù‚ÙŠÙ‚Ø©`;
            } else if (minutes > 0) {
                return `${minutes} Ø¯Ù‚ÙŠÙ‚Ø© ${seconds % 60} Ø«Ø§Ù†ÙŠØ©`;
            } else {
                return `${seconds} Ø«Ø§Ù†ÙŠØ©`;
            }
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function formatGregorianDate(dateStr) {
            if (!dateStr) return "";
            try {
                if (dateStr.includes('T')) {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('ar-SA', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        weekday: 'long'
                    });
                }
                return dateStr;
            } catch (e) {
                return dateStr;
            }
        }
        
        function getTrendIcon(current, previous) {
            if (current > previous) return '<i class="fas fa-arrow-up" style="color: #27ae60;"></i>';
            if (current < previous) return '<i class="fas fa-arrow-down" style="color: #e74c3c;"></i>';
            return '<i class="fas fa-minus" style="color: #95a5a6;"></i>';
        }
        
        // ---------- Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ----------
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = 'fas fa-check-circle';
            if (type === 'error') icon = 'fas fa-exclamation-circle';
            if (type === 'warning') icon = 'fas fa-exclamation-triangle';
            if (type === 'info') icon = 'fas fa-info-circle';
            
            notification.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // ---------- Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ----------
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function showSettings() {
            showModal('settingsModal');
        }
        
        // ---------- Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ----------
        function backupData() {
            const stats = JSON.parse(localStorage.getItem("siteStats") || "{}");
            const loginHistory = JSON.parse(localStorage.getItem("loginHistory") || "[]");
            const sessionHistory = JSON.parse(localStorage.getItem("sessionHistory") || "[]");
            
            const data = {
                statistics: stats,
                loginHistory: loginHistory,
                sessionHistory: sessionHistory,
                backupDate: new Date().toISOString(),
                version: '1.0.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `abrar-schools-backup-${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
        function resetStatistics() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªØŸ')) {
                const stats = {
                    logins: 0,
                    downloads: {},
                    bookDownloads: {},
                    sessionDurations: [],
                    averageSessionDuration: 0,
                    todayDownloads: {},
                    lastUpdate: new Date().toISOString()
                };
                
                localStorage.setItem("siteStats", JSON.stringify(stats));
                localStorage.setItem("loginHistory", JSON.stringify([]));
                localStorage.setItem("sessionHistory", JSON.stringify([]));
                
                refreshStatistics();
                showNotification('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }
        
        function clearAllData() {
            if (confirm('âš ï¸ ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                localStorage.clear();
                refreshStatistics();
                showNotification('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'warning');
            }
        }
        
        // ---------- Ø¯ÙˆØ§Ù„ Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„Ø¨Ø­Ø« ----------
        function filterTable(filter) {
            currentFilter = filter;
            const buttons = document.querySelectorAll('.filter-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            displayLoginHistory(JSON.parse(localStorage.getItem("loginHistory") || "[]"));
        }
        
        function filterSessions(filter) {
            displaySessionHistory(JSON.parse(localStorage.getItem("sessionHistory") || "[]"), filter);
        }
        
        function filterBooks(filter) {
            displayTopDownloads(JSON.parse(localStorage.getItem("siteStats") || "{}"), getAllBooks(), filter);
        }
        
        function toggleSection(element) {
            const section = element.closest('.charts-section, .table-container');
            const content = section.querySelector('.section-description, .table-description');
            const nextElements = [];
            let next = content.nextElementSibling;
            
            while (next && !next.classList.contains('.charts-section') && !next.classList.contains('.table-container')) {
                nextElements.push(next);
                next = next.nextElementSibling;
            }
            
            const isExpanded = !element.classList.contains('collapsed');
            
            if (isExpanded) {
                element.classList.add('collapsed');
                nextElements.forEach(el => {
                    el.style.maxHeight = '0';
                    el.style.opacity = '0';
                    el.style.margin = '0';
                    el.style.padding = '0';
                });
            } else {
                element.classList.remove('collapsed');
                nextElements.forEach(el => {
                    if (el.classList.contains('bar-chart') || el.classList.contains('table-wrapper')) {
                        el.style.maxHeight = el.scrollHeight + 'px';
                    } else {
                        el.style.maxHeight = '1000px';
                    }
                    el.style.opacity = '1';
                    el.style.margin = '';
                    el.style.padding = '';
                });
            }
        }
        
        // ---------- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ§Ù„Ø¹Ø±Ø¶ ----------
        function refreshStatistics() {
            displayStatistics();
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
        function exportData() {
            const stats = JSON.parse(localStorage.getItem("siteStats") || "{}");
            const loginHistory = JSON.parse(localStorage.getItem("loginHistory") || "[]");
            const sessionHistory = JSON.parse(localStorage.getItem("sessionHistory") || "[]");
            
            const data = {
                statistics: stats,
                loginHistory: loginHistory,
                sessionHistory: sessionHistory,
                exportDate: new Date().toISOString(),
                generatedBy: "Abrar Schools Analytics"
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `abrar-analytics-export-${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
        function clearOldData() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ù…Ø§ Ø¹Ø¯Ø§ Ø¢Ø®Ø± 30 ÙŠÙˆÙ…)ØŸ')) {
                const loginHistory = JSON.parse(localStorage.getItem("loginHistory") || "[]");
                const sessionHistory = JSON.parse(localStorage.getItem("sessionHistory") || "[]");
                
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                const filteredLogins = loginHistory.filter(record => {
                    try {
                        const recordDate = new Date(record.loginTimestamp || record.date);
                        return recordDate >= thirtyDaysAgo;
                    } catch {
                        return true;
                    }
                });
                
                const filteredSessions = sessionHistory.filter(session => {
                    try {
                        const sessionDate = new Date(session.timestamp || session.date);
                        return sessionDate >= thirtyDaysAgo;
                    } catch {
                        return true;
                    }
                });
                
                localStorage.setItem('loginHistory', JSON.stringify(filteredLogins));
                localStorage.setItem('sessionHistory', JSON.stringify(filteredSessions));
                
                refreshStatistics();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }
        
        function showDetailedReport() {
            const report = generateDetailedReport();
            const modalContent = document.getElementById('detailedReportContent');
            
            modalContent.innerHTML = `
                <h2 style="color: var(--primary-dark); margin-bottom: 25px; text-align: center;">
                    <i class="fas fa-chart-line"></i> Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ Ø§Ù„Ù…ÙØµÙ„
                </h2>
                
                <div style="display: grid; gap: 25px;">
                    <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 25px; border-radius: 15px; border-left: 5px solid var(--primary);">
                        <h3 style="color: var(--primary-dark); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-list-alt"></i> Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                                <div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</div>
                                <div style="font-size: 2.5em; font-weight: 800; color: var(--primary-dark);">${report.summary.activeUsers}</div>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                                <div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø¬Ù„Ø³Ø©</div>
                                <div style="font-size: 2.5em; font-weight: 800; color: var(--gold);">${Math.round(report.summary.avgSessionTime / 60000)}<span style="font-size: 0.5em;"> Ø¯</span></div>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                                <div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</div>
                                <div style="font-size: 2.5em; font-weight: 800; color: var(--info);">${report.summary.engagementRate}<span style="font-size: 0.5em;">%</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                        <div style="background: linear-gradient(135deg, #fff8e1, #ffeaa7); padding: 25px; border-radius: 15px; border-left: 5px solid var(--gold);">
                            <h3 style="color: #d35400; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-trophy"></i> Ø§Ù„Ø£ÙƒØ«Ø± Ù†Ø´Ø§Ø·Ø§Ù‹
                            </h3>
                            <div style="max-height: 300px; overflow-y: auto;">
                                ${report.topPerformers.mostActiveUsers.map((user, index) => `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.1);">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <span style="font-weight: 800; color: ${index < 3 ? 'var(--gold)' : '#666'};">${index + 1}</span>
                                            <span style="font-weight: 600;">${user.name}</span>
                                        </div>
                                        <span style="background: var(--primary); color: white; padding: 5px 12px; border-radius: 15px; font-weight: 700;">${user.logins}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #e8f6f3, #a3e4d7); padding: 25px; border-radius: 15px; border-left: 5px solid var(--primary);">
                            <h3 style="color: var(--primary-dark); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø²Ù…Ù†ÙŠ
                            </h3>
                            <div style="max-height: 300px; overflow-y: auto;">
                                ${report.timeAnalysis.peakHours.map(hour => `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.1);">
                                        <span style="font-weight: 600;">${hour.hour}:00</span>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <div style="width: 100px; height: 8px; background: #ddd; border-radius: 4px; overflow: hidden;">
                                                <div style="height: 100%; width: ${(hour.count / Math.max(...report.timeAnalysis.peakHours.map(h => h.count))) * 100}%; background: var(--primary);"></div>
                                            </div>
                                            <span style="font-weight: 700; color: var(--primary-dark);">${hour.count}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    ${report.recommendations.length > 0 ? `
                    <div style="background: linear-gradient(135deg, #ffeaa7, #fab1a0); padding: 25px; border-radius: 15px; border-left: 5px solid var(--danger);">
                        <h3 style="color: #d63031; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-lightbulb"></i> Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                        </h3>
                        <ul style="list-style: none; padding: 0;">
                            ${report.recommendations.map(rec => `
                                <li style="padding: 12px; background: rgba(255,255,255,0.8); margin-bottom: 10px; border-radius: 10px; display: flex; align-items: flex-start; gap: 12px;">
                                    <i class="fas fa-check-circle" style="color: var(--primary); margin-top: 4px;"></i>
                                    <span>${rec}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    <div style="text-align: center; padding: 20px; color: #666; font-size: 0.9em; border-top: 2px solid #eee;">
                        <i class="fas fa-clock"></i> ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ: ${new Date().toLocaleString('ar-SA', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}
                    </div>
                </div>
            `;
            
            showModal('detailedReportModal');
        }
        
        // ---------- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ----------
        function displayStatistics() {
            const stats = initializeStats();
            const books = getAllBooks();
            const loginHistory = JSON.parse(localStorage.getItem("loginHistory") || "[]");
            const sessionHistory = JSON.parse(localStorage.getItem("sessionHistory") || "[]");
            
            // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
            document.getElementById("lastUpdateTime").textContent = 
                new Date().toLocaleTimeString('ar-SA', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            
            // Ø­Ø³Ø§Ø¨ Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const dataSize = JSON.stringify(localStorage).length;
            document.getElementById("dataSize").textContent = formatFileSize(dataSize);
            
            // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
            document.getElementById("totalLogins").textContent = stats.logins || 0;
            
            // Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„ÙØ±ÙŠØ¯ÙŠÙ†
            const uniqueUsers = new Set(loginHistory.map(record => record.name));
            document.getElementById("uniqueUsers").textContent = 
                `${uniqueUsers.size} Ù…Ø³ØªØ®Ø¯Ù… ÙØ±ÙŠØ¯`;
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
            const today = new Date().toDateString();
            const todayLogins = loginHistory.filter(record => {
                try {
                    const recordDate = new Date(record.loginTimestamp || record.date);
                    return recordDate.toDateString() === today;
                } catch {
                    return false;
                }
            }).length;
            
            document.getElementById("todayLogins").textContent = todayLogins;
            document.getElementById("todayLoginsProgress").style.width = `${Math.min((todayLogins / (stats.logins || 1)) * 100, 100)}%`;
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© ÙˆØ´Ù‡Ø±ÙŠØ©
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const monthAgo = new Date();
            monthAgo.setDate(monthAgo.getDate() - 30);
            
            const weeklyLogins = loginHistory.filter(record => {
                try {
                    const recordDate = new Date(record.loginTimestamp || record.date);
                    return recordDate >= weekAgo;
                } catch {
                    return false;
                }
            }).length;
            
            const monthlyLogins = loginHistory.filter(record => {
                try {
                    const recordDate = new Date(record.loginTimestamp || record.date);
                    return recordDate >= monthAgo;
                } catch {
                    return false;
                }
            }).length;
            
            document.getElementById("weeklyLogins").textContent = weeklyLogins;
            document.getElementById("monthlyLogins").textContent = monthlyLogins;
            
            // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
            const totalDownloads = Object.values(stats.downloads || {}).reduce((a, b) => a + b, 0);
            document.getElementById("totalDownloads").textContent = totalDownloads;
            
            // ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…
            const todayDownloads = getDailyStats(stats);
            document.getElementById("todayDownloads").textContent = todayDownloads;
            document.getElementById("todayDownloadsProgress").style.width = `${Math.min((todayDownloads / Math.max(totalDownloads, 1)) * 100, 100)}%`;
            
            // Ù…ØªÙˆØ³Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ³Ø§Ø¹Ø© Ø§Ù„Ø°Ø±ÙˆØ©
            const avgDailyDownloads = getAvgDailyDownloads(stats);
            document.getElementById("avgDailyDownloads").textContent = avgDailyDownloads;
            
            const peakHour = getPeakHour(stats);
            document.getElementById("peakHour").textContent = peakHour;
            
            // Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
            const downloadTrend = getDownloadTrend(stats);
            document.getElementById("downloadTrend").innerHTML = downloadTrend;
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¬Ù„Ø³Ø§Øª
            const avgDuration = stats.averageSessionDuration || 0;
            document.getElementById("avgSessionTime").textContent = Math.round(avgDuration / 60000);
            
            const sessionStats = getSessionStats(sessionHistory);
            document.getElementById("longestSession").textContent = 
                sessionStats.longest > 0 ? Math.round(sessionStats.longest / 60000) + " Ø¯" : "0";
            document.getElementById("shortestSession").textContent = 
                sessionStats.shortest > 0 ? Math.round(sessionStats.shortest / 60000) + " Ø¯" : "0";
            document.getElementById("sessionDurationProgress").style.width = 
                `${Math.min((avgDuration / Math.max(sessionStats.longest, 1)) * 100, 100)}%`;
            
            const totalSessionTime = (stats.sessionDurations || []).reduce((a, b) => a + b, 0);
            document.getElementById("totalSessionTime").textContent = 
                `${Math.round(totalSessionTime / 3600000)} Ø³Ø§Ø¹Ø©`;
            
            // Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
            const sessionTrend = getSessionTrend(stats);
            document.getElementById("sessionTrend").innerHTML = sessionTrend;
            
            // Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØªØ¨
            document.getElementById("totalBooks").textContent = books.length;
            
            // Ø§Ù„ÙƒØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ù‡Ø¬
            const booksByCurriculum = getBooksByCurriculum(books);
            document.getElementById("egyptBooksCount").textContent = booksByCurriculum.egyptCount;
            document.getElementById("saudiBooksCount").textContent = booksByCurriculum.saudiCount;
            document.getElementById("egyptBooksProgress").style.width = 
                `${(booksByCurriculum.egyptCount / Math.max(books.length, 1)) * 100}%`;
            
            // Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ÙƒØªØ¨
            const booksTrend = getBooksTrend(books);
            document.getElementById("booksTrend").innerHTML = booksTrend;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
            displayLoginHistory(loginHistory);
            displaySessionHistory(sessionHistory);
            displayTopDownloads(stats, books);
            
            // Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª
            drawCharts(stats, books);
        }
        
        function displayLoginHistory(loginHistory) {
            const tableBody = document.getElementById("loginHistoryTable");
            const emptyState = document.getElementById("loginHistoryEmpty");
            
            tableBody.innerHTML = "";
            
            if (loginHistory.length === 0) {
                emptyState.style.display = "block";
                return;
            }
            
            emptyState.style.display = "none";
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
            let filteredLogins = loginHistory;
            if (currentFilter === 'Ù…ØµØ±ÙŠ') {
                filteredLogins = loginHistory.filter(record => record.curriculum === 'Ù…ØµØ±ÙŠ');
            } else if (currentFilter === 'Ø³Ø¹ÙˆØ¯ÙŠ') {
                filteredLogins = loginHistory.filter(record => record.curriculum === 'Ø³Ø¹ÙˆØ¯ÙŠ');
            } else if (currentFilter === 'today') {
                const today = new Date().toDateString();
                filteredLogins = loginHistory.filter(record => {
                    try {
                        const recordDate = new Date(record.loginTimestamp || record.date);
                        return recordDate.toDateString() === today;
                    } catch {
                        return false;
                    }
                });
            }
            
            // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 100 Ø³Ø¬Ù„ ÙÙ‚Ø·
            const recentLogins = filteredLogins.slice(0, 100);
            
            recentLogins.forEach((record, index) => {
                const row = document.createElement("tr");
                
                row.innerHTML = `
                    <td><strong class="rank-${index + 1}">${index + 1}</strong></td>
                    <td><strong>${record.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</strong></td>
                    <td><span class="grade-badge">${record.grade || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></td>
                    <td><span class="curriculum-badge badge-${record.curriculum === "Ù…ØµØ±ÙŠ" ? "egypt" : "saudi"}">
                        ${record.curriculum || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                    </span></td>
                    <td><span class="date-badge">${formatGregorianDate(record.date) || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></td>
                    <td><span class="time-badge">${record.time || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></td>
                    <td>
                        <button class="btn-icon secondary" onclick="viewUserDetails('${record.name}')" style="padding: 5px 10px; font-size: 0.9em;">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        function displaySessionHistory(sessionHistory, filter = 'all') {
            const tableBody = document.getElementById("sessionHistoryTable");
            const emptyState = document.getElementById("sessionHistoryEmpty");
            
            tableBody.innerHTML = "";
            
            if (sessionHistory.length === 0) {
                emptyState.style.display = "block";
                return;
            }
            
            emptyState.style.display = "none";
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
            let filteredSessions = sessionHistory;
            if (filter === 'long') {
                filteredSessions = [...sessionHistory].sort((a, b) => b.duration - a.duration);
            } else if (filter === 'short') {
                filteredSessions = [...sessionHistory].sort((a, b) => a.duration - b.duration);
            } else if (filter === 'today') {
                const today = new Date().toDateString();
                filteredSessions = sessionHistory.filter(session => {
                    try {
                        const sessionDate = new Date(session.timestamp || session.date);
                        return sessionDate.toDateString() === today;
                    } catch {
                        return false;
                    }
                });
            }
            
            // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 50 Ø¬Ù„Ø³Ø© ÙÙ‚Ø·
            const recentSessions = filteredSessions.slice(0, 50);
            
            recentSessions.forEach((session, index) => {
                const row = document.createElement("tr");
                
                row.innerHTML = `
                    <td><strong>${session.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</strong></td>
                    <td><span class="grade-badge">${session.grade || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></td>
                    <td><span class="duration-badge">${formatDuration(session.duration)}</span></td>
                    <td><span class="time-badge">${session.loginTime || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></td>
                    <td><span class="time-badge">${session.logoutTime || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        function displayTopDownloads(stats, books, filter = 'all') {
            const tableBody = document.getElementById("topDownloadsTable");
            const emptyState = document.getElementById("topDownloadsEmpty");
            
            tableBody.innerHTML = "";
            
            // ØªØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØªØ¨
            const bookDownloads = [];
            books.forEach(book => {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒØªØ§Ø¨ ÙÙŠ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„
                const downloads = stats.downloads?.[book.title] || 
                                 stats.bookDownloads?.[book.title] || 
                                 (stats.downloads ? Object.entries(stats.downloads)
                                     .find(([key]) => key.includes(book.title))?.[1] : 0) || 0;
                
                if (downloads > 0) {
                    bookDownloads.push({
                        ...book,
                        downloads: downloads,
                        trend: getBookTrend(book.title, stats)
                    });
                }
            });
            
            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ÙƒØªØ¨ Ù…Ø¹ ØªØ­Ù…ÙŠÙ„Ø§ØªØŒ Ù†Ø¹Ø±Ø¶ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙ‚Ø·
            if (bookDownloads.length === 0) {
                // Ø¹Ø±Ø¶ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙ‚Ø·
                books.slice(0, 10).forEach((book, index) => {
                    const row = document.createElement("tr");
                    
                    row.innerHTML = `
                        <td><strong class="rank-${index + 1}">${index + 1}</strong></td>
                        <td>${book.title}</td>
                        <td><span class="curriculum-badge badge-${book.curriculum === "Ù…ØµØ±ÙŠ" ? "egypt" : "saudi"}">
                            ${book.curriculum}
                        </span></td>
                        <td><strong>0</strong></td>
                        <td><i class="fas fa-minus" style="color: #95a5a6;"></i></td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                emptyState.style.display = "none";
                return;
            }
            
            emptyState.style.display = "none";
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
            let filteredBooks = bookDownloads;
            if (filter === 'Ù…ØµØ±ÙŠ') {
                filteredBooks = bookDownloads.filter(book => book.curriculum === 'Ù…ØµØ±ÙŠ');
            } else if (filter === 'Ø³Ø¹ÙˆØ¯ÙŠ') {
                filteredBooks = bookDownloads.filter(book => book.curriculum === 'Ø³Ø¹ÙˆØ¯ÙŠ');
            } else if (filter === 'month') {
                const monthAgo = new Date();
                monthAgo.setMonth(monthAgo.getMonth() - 1);
                // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹
            }
            
            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
            filteredBooks.sort((a, b) => b.downloads - a.downloads);
            
            // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 10 ÙƒØªØ¨ ÙÙ‚Ø·
            const topBooks = filteredBooks.slice(0, 10);
            
            topBooks.forEach((book, index) => {
                const row = document.createElement("tr");
                
                row.innerHTML = `
                    <td><strong class="rank-${index + 1}">${index + 1}</strong></td>
                    <td>${book.title}</td>
                    <td><span class="curriculum-badge badge-${book.curriculum === "Ù…ØµØ±ÙŠ" ? "egypt" : "saudi"}">
                        ${book.curriculum}
                    </span></td>
                    <td><strong>${book.downloads}</strong></td>
                    <td>${book.trend}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        function drawCharts(stats, books) {
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const yearData = {};
            const termData = {};
            const subjectData = {};
            const gradeData = {};
            
            books.forEach((book) => {
                const downloads = stats.downloads?.[book.title] || 
                                stats.bookDownloads?.[book.title] || 0;
                
                yearData[book.year] = (yearData[book.year] || 0) + downloads;
                termData[book.term] = (termData[book.term] || 0) + downloads;
                subjectData[book.subject] = (subjectData[book.subject] || 0) + downloads;
                gradeData[book.grade] = (gradeData[book.grade] || 0) + downloads;
            });
            
            // Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª
            drawBarChart("yearChart", yearData, 'Ø³Ù†Ø©');
            drawBarChart("termChart", termData, 'ÙØµÙ„');
            drawBarChart("subjectChart", subjectData, 'Ù…Ø§Ø¯Ø©');
            drawBarChart("gradeChart", gradeData, 'ØµÙ');
        }
        
        function drawBarChart(elementId, data, labelType) {
            const container = document.getElementById(elementId);
            if (!container) return;
            
            container.innerHTML = "";
            
            const entries = Object.entries(data);
            if (entries.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 30px;">
                        <i class="fas fa-chart-bar"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶</p>
                    </div>
                `;
                return;
            }
            
            const maxValue = Math.max(...Object.values(data), 1);
            
            entries
                .sort((a, b) => b[1] - a[1])
                .forEach(([label, value]) => {
                    const percentage = (value / maxValue) * 100;
                    const isTop = value === maxValue;
                    
                    const barItem = document.createElement("div");
                    barItem.className = "bar-item";
                    
                    barItem.innerHTML = `
                        <div class="bar-label">
                            <i class="fas fa-${getIconForLabel(labelType, label)}"></i>
                            ${label}
                        </div>
                        <div class="bar-container">
                            <div class="bar-fill ${isTop ? 'premium' : ''}" style="width: ${percentage}%">
                                <span class="bar-value">${value}</span>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(barItem);
                });
        }
        
        function getIconForLabel(type, label) {
            const icons = {
                'Ø³Ù†Ø©': 'calendar-alt',
                'ÙØµÙ„': 'layer-group',
                'Ù…Ø§Ø¯Ø©': 'book-open',
                'ØµÙ': 'graduation-cap'
            };
            
            return icons[type] || 'chart-bar';
        }
        
        // ---------- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ----------
        function initializeStats() {
            const stats = JSON.parse(localStorage.getItem("siteStats") || "{}");
            
            if (!stats.logins) {
                stats.logins = 0;
                stats.downloads = {};
                stats.bookDownloads = {};
                stats.sessionDurations = [];
                stats.averageSessionDuration = 0;
                stats.todayDownloads = {};
                stats.lastUpdate = new Date().toISOString();
            }
            
            return stats;
        }
        
        function getAllBooks() {
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„ÙƒØªØ¨ Ù…Ù† localStorage
            let egyptBooks = [];
            let saudiBooks = [];
            
            try {
                const egyptBooksData = localStorage.getItem("egyptBooks");
                const saudiBooksData = localStorage.getItem("saudiBooks");
                
                if (egyptBooksData) {
                    egyptBooks = JSON.parse(egyptBooksData);
                }
                
                if (saudiBooksData) {
                    saudiBooks = JSON.parse(saudiBooksData);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨:', error);
            }
            
            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ÙƒØªØ¨ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            if (egyptBooks.length === 0 && saudiBooks.length === 0) {
                // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„ÙƒØªØ¨ Ø§Ù„Ù…ØµØ±ÙŠØ©
                egyptBooks = [
                    { title: "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", curriculum: "Ù…ØµØ±ÙŠ", grade: "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", year: "1446", term: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„", subject: "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" },
                    { title: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", curriculum: "Ù…ØµØ±ÙŠ", grade: "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", year: "1446", term: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„", subject: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª" },
                    { title: "Ø§Ù„Ø¹Ù„ÙˆÙ… - Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", curriculum: "Ù…ØµØ±ÙŠ", grade: "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", year: "1446", term: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„", subject: "Ø§Ù„Ø¹Ù„ÙˆÙ…" },
                    { title: "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", curriculum: "Ù…ØµØ±ÙŠ", grade: "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", year: "1446", term: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„", subject: "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" },
                    { title: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", curriculum: "Ù…ØµØ±ÙŠ", grade: "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", year: "1446", term: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„", subject: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª" }
                ];
                
                // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„ÙƒØªØ¨ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
                saudiBooks = [
                    { title: "Ø§Ù„Ù„ØºÙ€Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠÙ€Ø© - Ø§Ù„ØµÙ€Ù Ø§Ù„Ø£ÙˆÙ„ Ø§Ø¨ØªÙ€Ø¯Ø§Ø¦ÙŠ", curriculum: "Ø³Ø¹ÙˆØ¯ÙŠ", grade: "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", year: "1446", term: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„", subject: "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" },
                    { title: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠÙ€Ø§Øª - Ø§Ù„ØµÙ€Ù Ø§Ù„Ø£ÙˆÙ„ Ø§Ø¨ØªÙ€Ø¯Ø§Ø¦ÙŠ", curriculum: "Ø³Ø¹ÙˆØ¯ÙŠ", grade: "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", year: "1446", term: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„", subject: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª" },
                    { title: "Ø§Ù„Ø¹Ù„Ù€ÙˆÙ… - Ø§Ù„ØµÙ€Ù Ø§Ù„Ø£ÙˆÙ„ Ø§Ø¨ØªÙ€Ø¯Ø§Ø¦ÙŠ", curriculum: "Ø³Ø¹ÙˆØ¯ÙŠ", grade: "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", year: "1446", term: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„", subject: "Ø§Ù„Ø¹Ù„ÙˆÙ…" },
                    { title: "Ø§Ù„Ù„ØºÙ€Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠÙ€Ø© - Ø§Ù„ØµÙ€Ù Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ø¨ØªÙ€Ø¯Ø§Ø¦ÙŠ", curriculum: "Ø³Ø¹ÙˆØ¯ÙŠ", grade: "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", year: "1446", term: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„", subject: "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" },
                    { title: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠÙ€Ø§Øª - Ø§Ù„ØµÙ€Ù Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ø¨ØªÙ€Ø¯Ø§Ø¦ÙŠ", curriculum: "Ø³Ø¹ÙˆØ¯ÙŠ", grade: "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", year: "1446", term: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„", subject: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª" }
                ];
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                try {
                    localStorage.setItem("egyptBooks", JSON.stringify(egyptBooks));
                    localStorage.setItem("saudiBooks", JSON.stringify(saudiBooks));
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:', error);
                }
            }
            
            return [
                ...egyptBooks.map((b) => ({ ...b, curriculum: "Ù…ØµØ±ÙŠ" })),
                ...saudiBooks.map((b) => ({ ...b, curriculum: "Ø³Ø¹ÙˆØ¯ÙŠ" })),
            ];
        }
        
        function getDailyStats(stats) {
            const today = new Date().toDateString();
            return (stats.todayDownloads && stats.todayDownloads[today]) || 0;
        }
        
        function getAvgDailyDownloads(stats) {
            if (!stats.todayDownloads) return 0;
            
            const downloadDays = Object.keys(stats.todayDownloads).length;
            if (downloadDays === 0) return 0;
            
            const totalDownloads = Object.values(stats.todayDownloads).reduce((a, b) => a + b, 0);
            return Math.round(totalDownloads / downloadDays);
        }
        
        function getPeakHour(stats) {
            // ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ† Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„ØªØªØ¨Ø¹ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ© Ø§Ù„ÙØ¹Ù„ÙŠØ©
            return "14:00";
        }
        
        function getDownloadTrend(stats) {
            const today = new Date().toDateString();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toDateString();
            
            const todayDownloads = stats.todayDownloads?.[today] || 0;
            const yesterdayDownloads = stats.todayDownloads?.[yesterdayStr] || 0;
            
            const diff = todayDownloads - yesterdayDownloads;
            const percentChange = yesterdayDownloads > 0 ? (diff / yesterdayDownloads) * 100 : 100;
            
            if (diff > 0) {
                return `<span style="color: #27ae60;">+${Math.abs(diff)} (${percentChange.toFixed(1)}%) â†‘</span>`;
            } else if (diff < 0) {
                return `<span style="color: #e74c3c;">-${Math.abs(diff)} (${percentChange.toFixed(1)}%) â†“</span>`;
            } else {
                return `<span style="color: #95a5a6;">Ù…Ø³ØªÙ‚Ø±</span>`;
            }
        }
        
        function getSessionStats(sessionHistory) {
            if (sessionHistory.length === 0) {
                return { longest: 0, shortest: 0 };
            }
            
            const durations = sessionHistory.map(s => s.duration).filter(d => d > 0);
            if (durations.length === 0) {
                return { longest: 0, shortest: 0 };
            }
            
            return {
                longest: Math.max(...durations),
                shortest: Math.min(...durations)
            };
        }
        
        function getSessionTrend(stats) {
            const durations = stats.sessionDurations || [];
            if (durations.length < 2) return "Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ©";
            
            const recentAvg = durations.slice(-5).reduce((a, b) => a + b, 0) / 5;
            const previousAvg = durations.slice(-10, -5).reduce((a, b) => a + b, 0) / 5;
            
            if (recentAvg > previousAvg) {
                return `<span style="color: #27ae60;">ØªØ­Ø³Ù† ${((recentAvg - previousAvg) / previousAvg * 100).toFixed(1)}% â†‘</span>`;
            } else if (recentAvg < previousAvg) {
                return `<span style="color: #e74c3c;">Ø§Ù†Ø®ÙØ§Ø¶ ${((previousAvg - recentAvg) / previousAvg * 100).toFixed(1)}% â†“</span>`;
            } else {
                return `<span style="color: #95a5a6;">Ù…Ø³ØªÙ‚Ø±</span>`;
            }
        }
        
        function getBooksByCurriculum(books) {
            const egyptCount = books.filter(b => b.curriculum === "Ù…ØµØ±ÙŠ").length;
            const saudiCount = books.filter(b => b.curriculum === "Ø³Ø¹ÙˆØ¯ÙŠ").length;
            
            return { egyptCount, saudiCount };
        }
        
        function getBooksTrend(books) {
            const egyptBooks = books.filter(b => b.curriculum === "Ù…ØµØ±ÙŠ");
            const saudiBooks = books.filter(b => b.curriculum === "Ø³Ø¹ÙˆØ¯ÙŠ");
            
            if (egyptBooks.length > saudiBooks.length) {
                return `<span style="color: var(--primary);">Ø§Ù„Ù…ØµØ±ÙŠ ${Math.round((egyptBooks.length / books.length) * 100)}%</span>`;
            } else if (saudiBooks.length > egyptBooks.length) {
                return `<span style="color: var(--gold);">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ ${Math.round((saudiBooks.length / books.length) * 100)}%</span>`;
            } else {
                return `<span style="color: #95a5a6;">Ù…ØªØ³Ø§ÙˆÙŠ</span>`;
            }
        }
        
        function getBookTrend(bookTitle, stats) {
            // ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ† Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„ØªØªØ¨Ø¹ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„ÙƒÙ„ ÙƒØªØ§Ø¨
            return '<i class="fas fa-minus" style="color: #95a5a6;"></i>';
        }
        
        function generateDetailedReport() {
            const stats = JSON.parse(localStorage.getItem("siteStats") || "{}");
            const loginHistory = JSON.parse(localStorage.getItem("loginHistory") || "[]");
            const sessionHistory = JSON.parse(localStorage.getItem("sessionHistory") || "[]");
            const books = getAllBooks();
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† (Ø¯Ø®Ù„ÙˆØ§ Ø®Ù„Ø§Ù„ Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…)
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const activeUsers = new Set(loginHistory.filter(record => {
                try {
                    const recordDate = new Date(record.loginTimestamp || record.date);
                    return recordDate >= weekAgo;
                } catch {
                    return false;
                }
            }).map(record => record.name)).size;
            
            // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
            const totalUsers = new Set(loginHistory.map(record => record.name)).size;
            const engagementRate = totalUsers > 0 ? Math.round((activeUsers / totalUsers) * 100) : 0;
            
            // Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù†Ø´Ø§Ø·Ø§Ù‹
            const userActivity = {};
            loginHistory.forEach(record => {
                userActivity[record.name] = (userActivity[record.name] || 0) + 1;
            });
            
            const mostActiveUsers = Object.entries(userActivity)
                .map(([name, logins]) => ({ name, logins }))
                .sort((a, b) => b.logins - a.logins)
                .slice(0, 10);
            
            // Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ©
            const hourCounts = {};
            loginHistory.forEach(record => {
                try {
                    const time = record.time || '';
                    const hour = time.split(':')[0];
                    if (hour) {
                        hourCounts[hour] = (hourCounts[hour] || 0) + 1;
                    }
                } catch (e) {}
            });
            
            const peakHours = Object.entries(hourCounts)
                .map(([hour, count]) => ({ hour: hour.padStart(2, '0'), count }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 5);
            
            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª
            const recommendations = [];
            
            if (activeUsers < 10) {
                recommendations.push("Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† Ù…Ù†Ø®ÙØ¶ØŒ ÙŠØ¬Ø¨ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©");
            }
            
            if (stats.averageSessionDuration < 300000) { // Ø£Ù‚Ù„ Ù…Ù† 5 Ø¯Ù‚Ø§Ø¦Ù‚
                recommendations.push("Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ù‚ØµÙŠØ±Ø©ØŒ ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ");
            }
            
            const egyptBooks = books.filter(b => b.curriculum === "Ù…ØµØ±ÙŠ").length;
            const saudiBooks = books.filter(b => b.curriculum === "Ø³Ø¹ÙˆØ¯ÙŠ").length;
            
            if (egyptBooks === 0 || saudiBooks === 0) {
                recommendations.push("ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© ÙƒØªØ¨ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ù‡Ø¬ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©");
            }
            
            return {
                summary: {
                    activeUsers,
                    totalUsers,
                    engagementRate,
                    avgSessionTime: stats.averageSessionDuration || 0,
                    totalDownloads: Object.values(stats.downloads || {}).reduce((a, b) => a + b, 0)
                },
                topPerformers: {
                    mostActiveUsers
                },
                timeAnalysis: {
                    peakHours
                },
                recommendations
            };
        }
        
        function viewUserDetails(username) {
            const loginHistory = JSON.parse(localStorage.getItem("loginHistory") || "[]");
            const userLogins = loginHistory.filter(record => record.name === username);
            
            if (userLogins.length === 0) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="close-modal" onclick="this.closest('.modal').remove()">âœ•</button>
                    <h2 style="color: var(--primary-dark); margin-bottom: 20px;">
                        <i class="fas fa-user"></i> ${username}
                    </h2>
                    <div style="display: grid; gap: 20px;">
                        <div>
                            <h3 style="color: var(--primary-dark); margin-bottom: 15px;">
                                <i class="fas fa-history"></i> Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                            </h3>
                            <div style="max-height: 300px; overflow-y: auto;">
                                ${userLogins.slice(0, 10).map(login => `
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: 600;">${login.date || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                            <span style="color: #666;">${login.time || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                        </div>
                                        <div style="margin-top: 10px; display: flex; gap: 10px;">
                                            <span class="grade-badge">${login.grade || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                            <span class="curriculum-badge badge-${login.curriculum === "Ù…ØµØ±ÙŠ" ? "egypt" : "saudi"}">
                                                ${login.curriculum || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                                            </span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div style="text-align: center; color: #666; font-size: 0.9em;">
                            <i class="fas fa-info-circle"></i> ${userLogins.length} Ø¹Ù…Ù„ÙŠØ© Ø¯Ø®ÙˆÙ„ Ø¥Ø¬Ù…Ø§Ù„Ø§Ù‹
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // ---------- Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ----------
        document.addEventListener('DOMContentLoaded', function() {
            // Ø¥Ù†Ø´Ø§Ø¡ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª
            createParticles();
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            displayStatistics();
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            if (isLoggedIn) {
                document.getElementById('logoutBtn').style.display = 'flex';
                document.getElementById('logoutBtn').onclick = function() {
                    sessionStorage.removeItem('isLoggedIn');
                    sessionStorage.removeItem('userData');
                    localStorage.removeItem('loginTime');
                    window.location.href = 'login.html';
                };
            }
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            const refreshInterval = localStorage.getItem('refreshInterval') || '60000';
            const autoRefreshToggle = localStorage.getItem('autoRefreshToggle') === 'true';
            
            document.getElementById('autoRefreshToggle').checked = autoRefreshToggle;
            document.getElementById('refreshInterval').value = refreshInterval;
            document.getElementById('autoRefresh').textContent = `${parseInt(refreshInterval) / 1000} Ø«Ø§Ù†ÙŠØ©`;
            
            if (autoRefreshToggle) {
                autoRefreshInterval = setInterval(refreshStatistics, parseInt(refreshInterval));
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„Ø£Ø­Ø¯Ø§Ø«
            document.getElementById('autoRefreshToggle').addEventListener('change', function() {
                localStorage.setItem('autoRefreshToggle', this.checked);
                clearInterval(autoRefreshInterval);
                if (this.checked) {
                    const interval = parseInt(document.getElementById('refreshInterval').value);
                    autoRefreshInterval = setInterval(refreshStatistics, interval);
                }
            });
            
            document.getElementById('refreshInterval').addEventListener('change', function() {
                localStorage.setItem('refreshInterval', this.value);
                clearInterval(autoRefreshInterval);
                if (document.getElementById('autoRefreshToggle').checked) {
                    autoRefreshInterval = setInterval(refreshStatistics, parseInt(this.value));
                }
                document.getElementById('autoRefresh').textContent = `${parseInt(this.value) / 1000} Ø«Ø§Ù†ÙŠØ©`;
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· CSS Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
            const style = document.createElement('style');
            style.textContent = `
                .btn-icon.danger {
                    background: linear-gradient(135deg, #e74c3c, #c0392b);
                    color: white;
                }
                
                .btn-icon.danger:hover {
                    background: linear-gradient(135deg, #c0392b, #a93226);
                }
            `;
            document.head.appendChild(style);
            
            // ØªÙˆØ³ÙŠØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
            setTimeout(() => {
                document.querySelectorAll('.section-collapse').forEach(section => {
                    if (expandedSections.has(section.closest('.charts-section, .table-container').id)) {
                        toggleSection(section);
                    }
                });
            }, 100);
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø¨Ø· Ø¨ØµÙØ­Ø© Ø§Ù„ÙƒØªØ¨
            setupBooksIntegration();
        });
        
        // ---------- Ø¯Ø§Ù„Ø© Ø±Ø¨Ø· ØµÙØ­Ø© Ø§Ù„ÙƒØªØ¨ ----------
        function setupBooksIntegration() {
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„ÙƒØªØ¨ Ù…Ù† Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø£Ø®Ø±Ù‰
            try {
                // Ø±Ø§Ø¨Ø· ÙƒØªØ¨ Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ù…ØµØ±ÙŠ
                fetch('books_egypt.html')
                    .then(response => response.text())
                    .then(html => {
                        // ØªØ­Ù„ÙŠÙ„ HTML ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ¨
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        
                        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙƒØªØ¨
                        const bookElements = doc.querySelectorAll('.book-card, [data-book], .book-item');
                        
                        if (bookElements.length > 0) {
                            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ¨
                            const books = Array.from(bookElements).map(el => {
                                const title = el.getAttribute('data-title') || 
                                            el.querySelector('.book-title, h3, .title')?.textContent || 
                                            'ÙƒØªØ§Ø¨ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
                                
                                const grade = el.getAttribute('data-grade') || 
                                            el.querySelector('.book-grade, .grade')?.textContent || 
                                            'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                                
                                const subject = el.getAttribute('data-subject') || 
                                               el.querySelector('.book-subject, .subject')?.textContent || 
                                               'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                                
                                const term = el.getAttribute('data-term') || 
                                            el.querySelector('.book-term, .term')?.textContent || 
                                            'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„';
                                
                                const year = el.getAttribute('data-year') || 
                                            el.querySelector('.book-year, .year')?.textContent || 
                                            '1446';
                                
                                return {
                                    title: title.trim(),
                                    curriculum: 'Ù…ØµØ±ÙŠ',
                                    grade: grade.trim(),
                                    subject: subject.trim(),
                                    term: term.trim(),
                                    year: year.trim()
                                };
                            });
                            
                            // Ø­ÙØ¸ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ØµØ±ÙŠØ©
                            localStorage.setItem('egyptBooks', JSON.stringify(books));
                        }
                    })
                    .catch(error => {
                        console.log('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØªØ¨ Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ù…ØµØ±ÙŠ:', error);
                    });
                
                // Ø±Ø§Ø¨Ø· ÙƒØªØ¨ Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ
                fetch('books_saudi.html')
                    .then(response => response.text())
                    .then(html => {
                        // ØªØ­Ù„ÙŠÙ„ HTML ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ¨
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        
                        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙƒØªØ¨
                        const bookElements = doc.querySelectorAll('.book-card, [data-book], .book-item');
                        
                        if (bookElements.length > 0) {
                            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ¨
                            const books = Array.from(bookElements).map(el => {
                                const title = el.getAttribute('data-title') || 
                                            el.querySelector('.book-title, h3, .title')?.textContent || 
                                            'ÙƒØªØ§Ø¨ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
                                
                                const grade = el.getAttribute('data-grade') || 
                                            el.querySelector('.book-grade, .grade')?.textContent || 
                                            'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                                
                                const subject = el.getAttribute('data-subject') || 
                                               el.querySelector('.book-subject, .subject')?.textContent || 
                                               'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                                
                                const term = el.getAttribute('data-term') || 
                                            el.querySelector('.book-term, .term')?.textContent || 
                                            'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„';
                                
                                const year = el.getAttribute('data-year') || 
                                            el.querySelector('.book-year, .year')?.textContent || 
                                            '1446';
                                
                                return {
                                    title: title.trim(),
                                    curriculum: 'Ø³Ø¹ÙˆØ¯ÙŠ',
                                    grade: grade.trim(),
                                    subject: subject.trim(),
                                    term: term.trim(),
                                    year: year.trim()
                                };
                            });
                            
                            // Ø­ÙØ¸ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
                            localStorage.setItem('saudiBooks', JSON.stringify(books));
                        }
                    })
                    .catch(error => {
                        console.log('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØªØ¨ Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ:', error);
                    });
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø±Ø¨Ø· ØµÙØ­Ø© Ø§Ù„ÙƒØªØ¨:', error);
            }
        }
        
        // ØªØ³Ø¬ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬ Ù„Ù‚ÙŠØ§Ø³ Ù…Ø¯Ø© Ø§Ù„Ø¨Ù‚Ø§Ø¡
        window.addEventListener('beforeunload', function() {
            const loginTime = localStorage.getItem('loginTime');
            if (loginTime && sessionStorage.getItem('isLoggedIn')) {
                const sessionDuration = Date.now() - parseInt(loginTime);
                const userData = JSON.parse(sessionStorage.getItem('userData') || '{}');
                
                // Ø­ÙØ¸ Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
                const sessionHistory = JSON.parse(localStorage.getItem('sessionHistory') || '[]');
                sessionHistory.unshift({
                    name: userData.name,
                    grade: userData.grade,
                    curriculum: userData.curriculum,
                    sessionId: userData.sessionId,
                    duration: sessionDuration,
                    date: new Date().toLocaleDateString('ar-SA'),
                    loginTime: new Date(parseInt(loginTime)).toLocaleTimeString('ar-SA'),
                    logoutTime: new Date().toLocaleTimeString('ar-SA'),
                    timestamp: new Date().toISOString()
                });
                
                // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ ÙÙ‚Ø· Ø¨Ø¢Ø®Ø± 50 Ø¬Ù„Ø³Ø©
                if (sessionHistory.length > 50) {
                    sessionHistory.length = 50;
                }
                
                localStorage.setItem('sessionHistory', JSON.stringify(sessionHistory));
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                const stats = JSON.parse(localStorage.getItem("siteStats") || "{}");
                if (!stats.sessionDurations) stats.sessionDurations = [];
                stats.sessionDurations.push(sessionDuration);
                
                // Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
                if (stats.sessionDurations.length > 0) {
                    const totalDuration = stats.sessionDurations.reduce((a, b) => a + b, 0);
                    stats.averageSessionDuration = totalDuration / stats.sessionDurations.length;
                }
                
                stats.lastUpdate = new Date().toISOString();
                localStorage.setItem("siteStats", JSON.stringify(stats));
                
                // Ø­Ø°Ù ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
                localStorage.removeItem('loginTime');
            }
        });
    </script>
</body>
</html>