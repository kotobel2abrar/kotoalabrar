<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª - Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø±</title>
    <link rel="icon" href="Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø±.webp" type="image/png" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
        min-height: 100vh;
      }
      .navbar {
        background: white;
        padding: 15px 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .navbar-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .site-title {
        font-size: 1.5em;
        color: #2d3748;
        font-weight: 700;
      }

      .nav-links {
        display: flex;
        gap: 20px;
      }

      .nav-links a {
        color: #3182ce;
        text-decoration: none;
        font-weight: 600;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .nav-links a:hover {
        background: #3182ce;
        color: white;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      .page-header {
        text-align: center;
        margin-bottom: 40px;
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .page-header h1 {
        color: #2d3748;
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .page-header p {
        color: #718096;
        font-size: 1.1em;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
      }

      .stat-card {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .stat-icon {
        font-size: 3em;
        margin-bottom: 15px;
      }

      .stat-number {
        font-size: 2.5em;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 10px;
      }

      .stat-label {
        color: #718096;
        font-size: 1.1em;
        font-weight: 600;
      }

      .charts-section {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .chart-title {
        color: #2d3748;
        font-size: 1.5em;
        font-weight: 700;
        margin-bottom: 20px;
        text-align: center;
      }

      .chart-container {
        margin-bottom: 40px;
      }

      .bar-chart {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .bar-item {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .bar-label {
        min-width: 150px;
        font-weight: 600;
        color: #4a5568;
      }

      .bar-container {
        flex: 1;
        height: 30px;
        background: #e2e8f0;
        border-radius: 15px;
        overflow: hidden;
        position: relative;
      }

      .bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #3182ce, #2c5282);
        border-radius: 15px;
        transition: width 1s ease;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 10px;
      }

      .bar-value {
        color: white;
        font-weight: 700;
        font-size: 0.9em;
      }

      .downloads-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .downloads-table th,
      .downloads-table td {
        padding: 15px;
        text-align: right;
        border-bottom: 1px solid #e2e8f0;
      }

      .downloads-table th {
        background: #f7fafc;
        color: #2d3748;
        font-weight: 700;
      }

      .downloads-table tr:hover {
        background: #f7fafc;
      }

      .curriculum-badge {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 600;
      }

      .badge-egypt {
        background: #fee;
        color: #e74c3c;
      }

      .badge-saudi {
        background: #efe;
        color: #27ae60;
      }

      footer {
        background: white;
        padding: 20px;
        text-align: center;
        margin-top: 50px;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      footer a {
        color: #3182ce;
        text-decoration: none;
        font-weight: 600;
      }

      @media (max-width: 768px) {
        .navbar-content {
          flex-direction: column;
          gap: 15px;
        }

        .page-header h1 {
          font-size: 2em;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .bar-label {
          min-width: 100px;
          font-size: 0.9em;
        }

        .downloads-table {
          font-size: 0.9em;
        }
      }
    </style>
    <script>
      (function () {
        const currentPage = window.location.pathname.split("/").pop();
        const allowedPages = ["login.html", "signin.html", "ØªØ³Ø¬ÙŠÙ„.html"];
        if (
          !allowedPages.some(
            (page) => currentPage.includes(page) || currentPage === ""
          )
        ) {
          if (!sessionStorage.getItem("isLoggedIn")) {
            window.location.replace("login.html");
          }
        }
      })();
    </script>
  </head>
  <body>
    <nav class="navbar">
      <div class="navbar-content">
        <div
          class="site-title"
          data-en="Abrar Schools Books"
          data-ar="ÙƒØªØ¨ Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø±"
        >
          ÙƒØªØ¨ Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø±
        </div>
        <div class="nav-links">
          <a href="index.html" data-en="Curriculums" data-ar="Ø§Ù„Ù…Ø³Ø§Ø±">Ø§Ù„Ù…Ø³Ø§Ø±</a>
          <a href="statistics.html" data-en="Statistics" data-ar="Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª"
            >Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</a
          >
          <a href="about.html" data-en="About" data-ar="Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"
            >Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</a
          >
          <a href="contact.html" data-en="Contact" data-ar="Ø§Ù„ØªÙˆØ§ØµÙ„">Ø§Ù„ØªÙˆØ§ØµÙ„</a>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="page-header">
        <h1 data-en="Statistics Dashboard" data-ar="Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª">
          Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        </h1>
        <p
          data-en="Real-time analytics and insights"
          data-ar="ØªØ­Ù„ÙŠÙ„Ø§Øª ÙˆØ±Ø¤Ù‰ ÙÙˆØ±ÙŠØ©"
        >
          ØªØ­Ù„ÙŠÙ„Ø§Øª ÙˆØ±Ø¤Ù‰ ÙÙˆØ±ÙŠØ©
        </p>
      </div>

      <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø© -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">ğŸ‘¥</div>
          <div class="stat-number" id="totalLogins">0</div>
          <div
            class="stat-label"
            data-en="Total Logins"
            data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„"
          >
            Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ğŸ“¥</div>
          <div class="stat-number" id="totalDownloads">0</div>
          <div
            class="stat-label"
            data-en="Total Downloads"
            data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª"
          >
            Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ğŸ“š</div>
          <div class="stat-number" id="totalBooks">0</div>
          <div
            class="stat-label"
            data-en="Available Books"
            data-ar="Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ØªÙˆÙØ±Ø©"
          >
            Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ØªÙˆÙØ±Ø©
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ğŸ”¥</div>
          <div class="stat-number" id="todayDownloads">0</div>
          <div
            class="stat-label"
            data-en="Today's Downloads"
            data-ar="ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…"
          >
            ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…
          </div>
        </div>
      </div>

      <!-- Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
      <div class="charts-section">
        <h2
          class="chart-title"
          data-en="Downloads by Academic Year"
          data-ar="Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©"
        >
          Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
        </h2>
        <div class="bar-chart" id="yearChart"></div>
      </div>

      <div class="charts-section">
        <h2
          class="chart-title"
          data-en="Downloads by Semester"
          data-ar="Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ"
        >
          Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ
        </h2>
        <div class="bar-chart" id="termChart"></div>
      </div>

      <div class="charts-section">
        <h2
          class="chart-title"
          data-en="Downloads by Subject"
          data-ar="Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©"
        >
          Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©
        </h2>
        <div class="bar-chart" id="subjectChart"></div>
      </div>

      <div class="charts-section">
        <h2
          class="chart-title"
          data-en="Downloads by Grade"
          data-ar="Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØµÙ"
        >
          Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØµÙ
        </h2>
        <div class="bar-chart" id="gradeChart"></div>
      </div>

      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„Ù…ÙØµÙ„ -->
      <div class="charts-section">
        <h2
          class="chart-title"
          data-en="Detailed Download Statistics"
          data-ar="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„Ù…ÙØµÙ„Ø©"
        >
          Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„Ù…ÙØµÙ„Ø©
        </h2>
        <table class="downloads-table">
          <thead>
            <tr>
              <th data-en="Book Title" data-ar="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨</th>
              <th data-en="Curriculum" data-ar="Ø§Ù„Ù…Ø³Ø§Ø±">Ø§Ù„Ù…Ø³Ø§Ø±</th>
              <th data-en="Subject" data-ar="Ø§Ù„Ù…Ø§Ø¯Ø©">Ø§Ù„Ù…Ø§Ø¯Ø©</th>
              <th data-en="Grade" data-ar="Ø§Ù„ØµÙ">Ø§Ù„ØµÙ</th>
              <th data-en="Downloads" data-ar="Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª">Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª</th>
            </tr>
          </thead>
          <tbody id="downloadsTableBody"></tbody>
        </table>
      </div>

      <footer>
        <a
          href="rights.html"
          data-en="All Rights Reserved Â© 2025 Abrar Private Schools"
          data-ar="Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2025 Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø± Ø§Ù„Ø£Ù‡Ù„ÙŠØ©"
          >Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2025 Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø± Ø§Ù„Ø£Ù‡Ù„ÙŠØ©</a
        >
      </footer>
    </div>

    <script>
      let currentLang = localStorage.getItem("siteLang") || "ar";

      function initLanguage() {
        if (currentLang === "en") applyLanguage("en");
      }

      function toggleLanguage() {
        currentLang = currentLang === "ar" ? "en" : "ar";
        localStorage.setItem("siteLang", currentLang);
        applyLanguage(currentLang);
      }

      function applyLanguage(lang) {
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === "ar" ? "rtl" : "ltr";

        document.querySelectorAll("[data-ar][data-en]").forEach((el) => {
          el.textContent = el.getAttribute("data-" + lang);
        });

        document.getElementById("langButton").textContent =
          lang === "ar" ? "ğŸŒ EN" : "ğŸŒ AR";
      }

      // ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      function initializeStats() {
        const stats = JSON.parse(localStorage.getItem("siteStats") || "{}");

        if (!stats.logins) {
          stats.logins = 0;
          stats.downloads = {};
          stats.bookDownloads = {};
          stats.lastUpdate = new Date().toISOString();
        }

        return stats;
      }

      // Ø­ÙØ¸ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      function saveStats(stats) {
        stats.lastUpdate = new Date().toISOString();
        localStorage.setItem("siteStats", JSON.stringify(stats));
      }

      // ØªØ³Ø¬ÙŠÙ„ ØªØ­Ù…ÙŠÙ„ ÙƒØªØ§Ø¨
      function recordDownload(bookId) {
        const stats = initializeStats();

        if (!stats.downloads[bookId]) {
          stats.downloads[bookId] = 0;
        }
        stats.downloads[bookId]++;

        const today = new Date().toDateString();
        if (!stats.todayDownloads) stats.todayDownloads = {};
        if (!stats.todayDownloads[today]) stats.todayDownloads[today] = 0;
        stats.todayDownloads[today]++;

        saveStats(stats);
      }

      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØªØ¨
      function getAllBooks() {
        const egyptBooks = JSON.parse(
          localStorage.getItem("egyptBooks") || "[]"
        );
        const saudiBooks = JSON.parse(
          localStorage.getItem("saudiBooks") || "[]"
        );

        return [
          ...egyptBooks.map((b) => ({ ...b, curriculum: "Ù…ØµØ±ÙŠ" })),
          ...saudiBooks.map((b) => ({ ...b, curriculum: "Ø³Ø¹ÙˆØ¯ÙŠ" })),
        ];
      }

      // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      function displayStatistics() {
        const stats = initializeStats();
        const books = getAllBooks();

        // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        document.getElementById("totalLogins").textContent = stats.logins || 0;

        const totalDownloads = Object.values(stats.downloads || {}).reduce(
          (a, b) => a + b,
          0
        );
        document.getElementById("totalDownloads").textContent = totalDownloads;
        document.getElementById("totalBooks").textContent = books.length;

        const today = new Date().toDateString();
        document.getElementById("todayDownloads").textContent =
          (stats.todayDownloads && stats.todayDownloads[today]) || 0;

        // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø§Øª
        const yearData = {};
        const termData = {};
        const subjectData = {};
        const gradeData = {};

        books.forEach((book) => {
          const downloads = stats.downloads[book.title] || 0;

          yearData[book.year] = (yearData[book.year] || 0) + downloads;
          termData[book.term] = (termData[book.term] || 0) + downloads;
          subjectData[book.subject] =
            (subjectData[book.subject] || 0) + downloads;
          gradeData[book.grade] = (gradeData[book.grade] || 0) + downloads;
        });

        // Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª
        drawBarChart("yearChart", yearData);
        drawBarChart("termChart", termData);
        drawBarChart("subjectChart", subjectData);
        drawBarChart("gradeChart", gradeData);

        // Ù…Ù„Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
        fillDownloadsTable(books, stats);
      }

      // Ø±Ø³Ù… Ù…Ø®Ø·Ø· Ø´Ø±ÙŠØ·ÙŠ
      function drawBarChart(elementId, data) {
        const container = document.getElementById(elementId);
        container.innerHTML = "";

        const maxValue = Math.max(...Object.values(data), 1);

        Object.entries(data)
          .sort((a, b) => b[1] - a[1])
          .forEach(([label, value]) => {
            const percentage = (value / maxValue) * 100;

            const barItem = document.createElement("div");
            barItem.className = "bar-item";

            barItem.innerHTML = `
                    <div class="bar-label">${label}</div>
                    <div class="bar-container">
                        <div class="bar-fill" style="width: ${percentage}%">
                            <span class="bar-value">${value}</span>
                        </div>
                    </div>
                `;

            container.appendChild(barItem);
          });
      }

      // Ù…Ù„Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
      function fillDownloadsTable(books, stats) {
        const tbody = document.getElementById("downloadsTableBody");
        tbody.innerHTML = "";

        const booksWithDownloads = books
          .map((book) => ({
            ...book,
            downloads: stats.downloads[book.title] || 0,
          }))
          .sort((a, b) => b.downloads - a.downloads);

        booksWithDownloads.forEach((book) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${book.title}</td>
                    <td><span class="curriculum-badge badge-${
                      book.curriculum === "Ù…ØµØ±ÙŠ" ? "egypt" : "saudi"
                    }">${book.curriculum}</span></td>
                    <td>${book.subject}</td>
                    <td>${book.grade}</td>
                    <td><strong>${book.downloads}</strong></td>
                `;
          tbody.appendChild(row);
        });
      }

      // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¬Ø¯ÙŠØ¯
      function recordLogin() {
        const stats = initializeStats();
        stats.logins++;
        saveStats(stats);
      }

      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
      initLanguage();
      displayStatistics();

      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· ÙƒØªØ§Ø¨
      document.addEventListener("click", (e) => {
        if (e.target.classList.contains("open-btn")) {
          const bookTitle = e.target
            .closest(".book-card")
            .querySelector(".book-title").textContent;
          recordDownload(bookTitle);
        }
      });
    </script>
    <script src="theme-menu.js"></script>
  </body>
</html>