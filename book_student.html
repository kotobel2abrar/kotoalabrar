<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© ÙƒØªØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ - Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø±</title>
    <link rel="icon" href="Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ø¨Ø±Ø§Ø±.webp" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #16a085;
            --light: #ecf0f1;
            --dark: #34495e;
            --gradient-admin: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-pending: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-approved: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --gradient-review: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-rejected: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(240, 147, 251, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© */
        .admin-header {
            background: rgba(255, 255, 255, 0.98);
            padding: 25px 35px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 25px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .admin-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .admin-title .icon {
            width: 70px;
            height: 70px;
            background: var(--gradient-admin);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .admin-title .icon i {
            font-size: 32px;
            color: white;
        }

        .admin-title h1 {
            color: var(--primary);
            font-size: 28px;
            font-weight: 800;
        }

        .admin-title p {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 5px;
        }

        .admin-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: var(--gradient-approved);
            color: white;
        }

        .btn-secondary {
            background: var(--gradient-review);
            color: white;
        }

        .btn-danger {
            background: var(--gradient-rejected);
            color: white;
        }

        .btn-warning {
            background: var(--gradient-pending);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.98);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
        }

        .stat-card.pending::before { background: var(--gradient-pending); }
        .stat-card.approved::before { background: var(--gradient-approved); }
        .stat-card.review::before { background: var(--gradient-review); }
        .stat-card.rejected::before { background: var(--gradient-rejected); }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .stat-title {
            color: #7f8c8d;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .stat-card.pending .stat-icon { background: var(--gradient-pending); }
        .stat-card.approved .stat-icon { background: var(--gradient-approved); }
        .stat-card.review .stat-icon { background: var(--gradient-review); }
        .stat-card.rejected .stat-icon { background: var(--gradient-rejected); }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
            line-height: 1;
        }

        .stat-label {
            color: #95a5a6;
            font-size: 13px;
            font-weight: 600;
        }

        /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… */
        .controls {
            background: rgba(255, 255, 255, 0.98);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #f8f9fa;
            font-family: 'Cairo', sans-serif;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
            background: white;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            padding-right: 50px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2395a5a6'%3E%3Cpath d='M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: left 15px center;
            background-size: 20px;
        }

        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØªØ¨ */
        .books-section {
            background: rgba(255, 255, 255, 0.98);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .section-title {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i {
            font-size: 26px;
            color: var(--secondary);
        }

        .books-table-container {
            overflow-x: auto;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .books-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        .books-table th {
            padding: 18px 20px;
            text-align: right;
            font-weight: 700;
            color: white;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 0.5px;
            background: var(--gradient-admin);
        }

        .books-table td {
            padding: 18px 20px;
            border-bottom: 1px solid #f0f0f0;
            color: #2c3e50;
            font-size: 14px;
            vertical-align: middle;
        }

        .books-table tr {
            transition: all 0.3s ease;
            background: white;
        }

        .books-table tr:hover {
            background: #f8f9fa;
            transform: scale(1.005);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .status-pending {
            background: var(--gradient-pending);
            color: white;
        }

        .status-approved {
            background: var(--gradient-approved);
            color: white;
        }

        .status-rejected {
            background: var(--gradient-rejected);
            color: white;
        }

        .status-review {
            background: var(--gradient-review);
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-admin);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 700;
            color: var(--primary);
        }

        .user-meta {
            font-size: 12px;
            color: #7f8c8d;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 80px;
            justify-content: center;
        }

        .btn-view {
            background: #e3f2fd;
            color: #1976d2;
        }

        .btn-approve {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .btn-reject {
            background: #ffebee;
            color: #c62828;
        }

        .btn-download {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        /* Ù†Ø§ÙØ°Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒØªØ§Ø¨ */
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .preview-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.4);
            animation: modalSlideUp 0.4s ease;
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .preview-header {
            padding: 25px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-header h2 {
            color: var(--primary);
            font-size: 24px;
            font-weight: 800;
        }

        .close-preview {
            background: none;
            border: none;
            font-size: 28px;
            color: #95a5a6;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-preview:hover {
            color: var(--danger);
        }

        .preview-body {
            padding: 25px;
        }

        .book-preview-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .book-cover {
            width: 100%;
            aspect-ratio: 3/4;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .book-details {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .detail-row {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .detail-label {
            font-weight: 700;
            color: var(--primary);
            min-width: 120px;
        }

        .detail-value {
            color: #2c3e50;
            flex: 1;
        }

        .notes-section {
            margin-top: 20px;
        }

        .notes-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .notes-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            min-height: 100px;
            resize: vertical;
            font-family: 'Cairo', sans-serif;
        }

        .notes-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
        }

        .preview-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
        .success-toast {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gradient-approved);
            color: white;
            padding: 18px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(67, 233, 123, 0.4);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #95a5a6;
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 18px;
            font-weight: 600;
        }

        /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .admin-header {
                padding: 20px;
                flex-direction: column;
                text-align: center;
            }

            .admin-title {
                flex-direction: column;
                text-align: center;
            }

            .admin-actions {
                width: 100%;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .book-preview-grid {
                grid-template-columns: 1fr;
            }

            .preview-actions {
                flex-direction: column;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
            }
        }

        .loading {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© -->
        <div class="admin-header">
            <div class="admin-title">
                <div class="icon">
                    <i class="fas fa-book-medical"></i>
                </div>
                <div>
                    <h1>Ø¥Ø¯Ø§Ø±Ø© ÙƒØªØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h1>
                    <p>Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØªØ¨ Ø§Ù„ØªÙŠ ÙŠØ±ÙØ¹Ù‡Ø§ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</p>
                </div>
            </div>
            <div class="admin-actions">
                <button class="btn btn-primary" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i>
                    <span>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                </button>
                <button class="btn btn-secondary" onclick="exportBooksData()">
                    <i class="fas fa-file-export"></i>
                    <span>ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                </button>
                <button class="btn btn-danger" onclick="clearAllData()">
                    <i class="fas fa-trash-alt"></i>
                    <span>Ù…Ø³Ø­ Ø§Ù„Ø¬Ù…ÙŠØ¹</span>
                </button>
            </div>
        </div>

        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
        <div class="stats-grid">
            <div class="stat-card pending" onclick="filterByStatus('pending')">
                <div class="stat-header">
                    <span class="stat-title">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                </div>
                <div class="stat-value" id="pendingCount">0</div>
                <div class="stat-label">ÙƒØªØ§Ø¨ ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
            </div>

            <div class="stat-card approved" onclick="filterByStatus('approved')">
                <div class="stat-header">
                    <span class="stat-title">Ù…Ù‚Ø¨ÙˆÙ„Ø©</span>
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                <div class="stat-value" id="approvedCount">0</div>
                <div class="stat-label">ÙƒØªØ§Ø¨ ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</div>
            </div>

            <div class="stat-card review" onclick="filterByStatus('review')">
                <div class="stat-header">
                    <span class="stat-title">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                    <div class="stat-icon">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
                <div class="stat-value" id="reviewCount">0</div>
                <div class="stat-label">ÙƒØªØ§Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
            </div>

            <div class="stat-card rejected" onclick="filterByStatus('rejected')">
                <div class="stat-header">
                    <span class="stat-title">Ù…Ø±ÙÙˆØ¶Ø©</span>
                    <div class="stat-icon">
                        <i class="fas fa-times-circle"></i>
                    </div>
                </div>
                <div class="stat-value" id="rejectedCount">0</div>
                <div class="stat-label">ÙƒØªØ§Ø¨ ØªÙ… Ø±ÙØ¶Ù‡</div>
            </div>
        </div>

        <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØµÙÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø« -->
        <div class="controls">
            <div class="filters-grid">
                <div class="form-group">
                    <label for="filterStatus">Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØªØ§Ø¨</label>
                    <select id="filterStatus" class="form-control" onchange="filterBooks()">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                        <option value="review">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                        <option value="approved">Ù…Ù‚Ø¨ÙˆÙ„Ø©</option>
                        <option value="rejected">Ù…Ø±ÙÙˆØ¶Ø©</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="filterSubject">Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
                    <select id="filterSubject" class="form-control" onchange="filterBooks()">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯</option>
                        <option value="Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                        <option value="Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©">Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©</option>
                        <option value="Ù„ØºØ© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ù„ØºØ© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                        <option value="Ø¹Ù„ÙˆÙ…">Ø¹Ù„ÙˆÙ…</option>
                        <option value="ÙÙŠØ²ÙŠØ§Ø¡">ÙÙŠØ²ÙŠØ§Ø¡</option>
                        <option value="ÙƒÙŠÙ…ÙŠØ§Ø¡">ÙƒÙŠÙ…ÙŠØ§Ø¡</option>
                        <option value="Ø£Ø­ÙŠØ§Ø¡">Ø£Ø­ÙŠØ§Ø¡</option>
                        <option value="ØªØ§Ø±ÙŠØ®">ØªØ§Ø±ÙŠØ®</option>
                        <option value="Ø¬ØºØ±Ø§ÙÙŠØ§">Ø¬ØºØ±Ø§ÙÙŠØ§</option>
                        <option value="Ù‚Ø±Ø¢Ù†">Ù‚Ø±Ø¢Ù†</option>
                        <option value="ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©">ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="filterGrade">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                    <select id="filterGrade" class="form-control" onchange="filterBooks()">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ</option>
                        <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                        <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                        <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                        <option value="Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                        <option value="Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                        <option value="Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                        <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                        <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                        <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
                        <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                        <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                        <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                    </select>
                </div>
                
                <div class="form-group search-box">
                    <label for="searchInput">Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙƒØªØ¨</label>
                    <input type="text" id="searchInput" class="form-control search-input" 
                           placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨..." 
                           onkeyup="searchBooks(this.value)">
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="btn btn-warning" onclick="resetFilters()">
                    <i class="fas fa-redo"></i>
                    <span>Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</span>
                </button>
                <button class="btn btn-primary" onclick="markAllForReview()">
                    <i class="fas fa-search"></i>
                    <span>ÙˆØ¶Ø¹ Ø§Ù„Ø¬Ù…ÙŠØ¹ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                </button>
            </div>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØªØ¨ -->
        <div class="books-section">
            <div class="section-title">
                <i class="fas fa-list-alt"></i>
                <span>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</span>
                <span style="font-size: 14px; color: #7f8c8d; margin-right: auto;" id="booksCount">(0 ÙƒØªØ§Ø¨)</span>
            </div>
            
            <div class="books-table-container">
                <table class="books-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨</th>
                            <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                            <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙØ¹</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="booksTableBody">
                        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </tbody>
                </table>
            </div>
            
            <div id="emptyState" class="empty-state" style="display: none;">
                <i class="fas fa-book-open"></i>
                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØªØ¨ Ù…Ø±ÙÙˆØ¹Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                <p style="font-size: 14px; margin-top: 10px;">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„ÙƒØªØ¨ Ø§Ù„ØªÙŠ ÙŠØ±ÙØ¹Ù‡Ø§ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ù† ØµÙØ­Ø© Ø­Ø³Ø§Ø¨Ø§ØªÙ‡Ù…</p>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨ -->
    <div id="previewModal" class="preview-modal">
        <div class="preview-content">
            <div class="preview-header">
                <h2>Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨</h2>
                <button class="close-preview" onclick="closePreview()">&times;</button>
            </div>
            
            <div class="preview-body">
                <div class="book-preview-grid">
                    <div class="book-cover" id="previewCover">
                        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </div>
                    
                    <div class="book-details">
                        <div class="detail-row">
                            <span class="detail-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨:</span>
                            <span class="detail-value" id="previewTitle">-</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label">Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</span>
                            <span class="detail-value" id="previewSubject">-</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</span>
                            <span class="detail-value" id="previewGrade">-</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</span>
                            <span class="detail-value" id="previewTerm">-</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</span>
                            <span class="detail-value" id="previewYear">-</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label">Ø§Ù„Ù„ØºØ©:</span>
                            <span class="detail-value" id="previewLanguage">-</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙØ¹:</span>
                            <span class="detail-value" id="previewDate">-</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label">Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØªØ§Ø¨:</span>
                            <span class="detail-value">
                                <a href="#" id="previewLink" target="_blank" style="color: #3498db; text-decoration: none;">
                                    <i class="fas fa-external-link-alt"></i> ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·
                                </a>
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">ÙˆØµÙ Ø§Ù„ÙƒØªØ§Ø¨:</span>
                    <span class="detail-value" id="previewDescription">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ</span>
                </div>
                
                <div class="detail-row">
                    <div class="user-info">
                        <div class="user-avatar" id="previewUserAvatar"></div>
                        <div class="user-details">
                            <span class="user-name" id="previewUserName">-</span>
                            <span class="user-meta">
                                <span id="previewUserCurriculum">-</span> | 
                                <span id="previewUserGrade">-</span>
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="notes-section">
                    <h3>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù</h3>
                    <textarea class="notes-input" id="adminNotes" 
                              placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ùˆ Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø±ÙØ¶..."></textarea>
                </div>
                
                <div class="preview-actions">
                    <button class="btn btn-primary" style="flex: 1;" onclick="approveBook()">
                        <i class="fas fa-check-circle"></i>
                        <span>Ù‚Ø¨ÙˆÙ„ Ø§Ù„ÙƒØªØ§Ø¨</span>
                    </button>
                    <button class="btn btn-danger" style="flex: 1;" onclick="rejectBook()">
                        <i class="fas fa-times-circle"></i>
                        <span>Ø±ÙØ¶ Ø§Ù„ÙƒØªØ§Ø¨</span>
                    </button>
                    <button class="btn btn-secondary" style="flex: 1;" onclick="markForReview()">
                        <i class="fas fa-search"></i>
                        <span>ÙˆØ¶Ø¹ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                    </button>
                    <button class="btn" style="flex: 1; background: #e0e0e0; color: #7f8c8d;" onclick="closePreview()">
                        <i class="fas fa-times"></i>
                        <span>Ø¥Ù„ØºØ§Ø¡</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        document.addEventListener('DOMContentLoaded', function() {
            loadBooks();
            updateStats();
            
            // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
            setInterval(loadBooks, 10000);
        });

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        let allBooks = [];
        let currentBookId = null;

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨ Ù…Ù† localStorage
        function loadBooks() {
            try {
                allBooks = JSON.parse(localStorage.getItem('submittedBooks') || '[]');
                console.log(`ğŸ“š ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allBooks.length} ÙƒØªØ§Ø¨ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                updateStats();
                
                // Ø¹Ø±Ø¶ Ø§Ù„ÙƒØªØ¨ Ø¨Ø¹Ø¯ Ø§Ù„ØªØµÙÙŠØ©
                filterBooks();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨:', error);
                showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨', 'error');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStats() {
            try {
                const pending = allBooks.filter(book => book.status === 'pending').length;
                const approved = allBooks.filter(book => book.status === 'approved').length;
                const review = allBooks.filter(book => book.status === 'review').length;
                const rejected = allBooks.filter(book => book.status === 'rejected').length;
                
                document.getElementById('pendingCount').textContent = pending;
                document.getElementById('approvedCount').textContent = approved;
                document.getElementById('reviewCount').textContent = review;
                document.getElementById('rejectedCount').textContent = rejected;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
            }
        }

        // ØªØµÙÙŠØ© Ø§Ù„ÙƒØªØ¨
        function filterBooks() {
            try {
                const statusFilter = document.getElementById('filterStatus').value;
                const subjectFilter = document.getElementById('filterSubject').value;
                const gradeFilter = document.getElementById('filterGrade').value;
                const searchQuery = document.getElementById('searchInput').value.toLowerCase();
                
                let filteredBooks = allBooks;
                
                // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
                if (statusFilter !== 'all') {
                    filteredBooks = filteredBooks.filter(book => book.status === statusFilter);
                }
                
                // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©
                if (subjectFilter !== 'all') {
                    filteredBooks = filteredBooks.filter(book => book.subject === subjectFilter);
                }
                
                // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØµÙ
                if (gradeFilter !== 'all') {
                    filteredBooks = filteredBooks.filter(book => book.grade === gradeFilter);
                }
                
                // Ø§Ù„Ø¨Ø­Ø«
                if (searchQuery) {
                    filteredBooks = filteredBooks.filter(book => 
                        book.title.toLowerCase().includes(searchQuery) ||
                        (book.userName && book.userName.toLowerCase().includes(searchQuery)) ||
                        (book.description && book.description.toLowerCase().includes(searchQuery))
                    );
                }
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                displayBooksTable(filteredBooks);
                
                // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØªØ¨
                document.getElementById('booksCount').textContent = `(${filteredBooks.length} ÙƒØªØ§Ø¨)`;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØµÙÙŠØ© Ø§Ù„ÙƒØªØ¨:', error);
            }
        }

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙƒØªØ¨
        function searchBooks(query) {
            filterBooks(); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù†ÙØ³ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØµÙÙŠØ©
        }

        // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
        function filterByStatus(status) {
            document.getElementById('filterStatus').value = status;
            filterBooks();
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±
        function resetFilters() {
            document.getElementById('filterStatus').value = 'all';
            document.getElementById('filterSubject').value = 'all';
            document.getElementById('filterGrade').value = 'all';
            document.getElementById('searchInput').value = '';
            filterBooks();
            showToast('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±');
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØªØ¨
        function displayBooksTable(books) {
            const tableBody = document.getElementById('booksTableBody');
            const emptyState = document.getElementById('emptyState');
            
            if (books.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            let html = '';
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„ÙƒØªØ¨ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
            books.sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt));
            
            books.forEach((book, index) => {
                const statusClass = `status-${book.status || 'pending'}`;
                const statusText = {
                    'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                    'review': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
                    'approved': 'Ù…Ù‚Ø¨ÙˆÙ„',
                    'rejected': 'Ù…Ø±ÙÙˆØ¶'
                }[book.status] || 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                
                const date = new Date(book.submittedAt).toLocaleDateString('ar-SA', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨
                const userInitials = book.userName ? book.userName.charAt(0).toUpperCase() : 'Ø·';
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <strong>${book.title}</strong><br>
                            <small style="color: #7f8c8d;">${book.subject}</small>
                        </td>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar">${userInitials}</div>
                                <div class="user-details">
                                    <span class="user-name">${book.userName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
                                    <span class="user-meta">${book.userCurriculum || ''} | ${book.userGrade || ''}</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div>Ø§Ù„ØµÙ: ${book.grade}</div>
                            <div>Ø§Ù„ÙØµÙ„: ${book.term}</div>
                            <div>Ø§Ù„Ø¹Ø§Ù…: ${book.year}</div>
                        </td>
                        <td>
                            <span class="status-badge ${statusClass}" onclick="changeStatus('${book.id}')">
                                ${statusText}
                            </span>
                        </td>
                        <td>${date}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-view" onclick="previewBook('${book.id}')">
                                    <i class="fas fa-eye"></i>
                                    Ù…Ø¹Ø§ÙŠÙ†Ø©
                                </button>
                                <button class="action-btn btn-approve" onclick="quickApprove('${book.id}')">
                                    <i class="fas fa-check"></i>
                                    Ù‚Ø¨ÙˆÙ„
                                </button>
                                <button class="action-btn btn-reject" onclick="quickReject('${book.id}')">
                                    <i class="fas fa-times"></i>
                                    Ø±ÙØ¶
                                </button>
                                <button class="action-btn btn-download" onclick="downloadBook('${book.id}')">
                                    <i class="fas fa-download"></i>
                                    ØªØ­Ù…ÙŠÙ„
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // Ù…Ø¹Ø§ÙŠÙ†Ø© ÙƒØªØ§Ø¨
        function previewBook(bookId) {
            try {
                const book = allBooks.find(b => b.id === bookId);
                if (!book) {
                    showToast('âŒ Ø§Ù„ÙƒØªØ§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                currentBookId = bookId;
                
                // ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨
                document.getElementById('previewTitle').textContent = book.title;
                document.getElementById('previewSubject').textContent = book.subject;
                document.getElementById('previewGrade').textContent = book.grade;
                document.getElementById('previewTerm').textContent = book.term;
                document.getElementById('previewYear').textContent = book.year;
                document.getElementById('previewLanguage').textContent = book.language;
                document.getElementById('previewDescription').textContent = book.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ';
                document.getElementById('previewLink').href = book.drive_link;
                
                // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙØ¹
                const date = new Date(book.submittedAt).toLocaleDateString('ar-SA', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                document.getElementById('previewDate').textContent = date;
                
                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
                document.getElementById('previewUserName').textContent = book.userName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                document.getElementById('previewUserCurriculum').textContent = book.userCurriculum || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                document.getElementById('previewUserGrade').textContent = book.userGrade || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                
                // Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù„Ø·Ø§Ù„Ø¨
                const userInitials = book.userName ? book.userName.charAt(0).toUpperCase() : 'Ø·';
                document.getElementById('previewUserAvatar').textContent = userInitials;
                
                // ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù
                const coverElement = document.getElementById('previewCover');
                if (book.cover_image && book.cover_image.startsWith('http')) {
                    coverElement.innerHTML = `<img src="${book.cover_image}" alt="ØºÙ„Ø§Ù Ø§Ù„ÙƒØªØ§Ø¨">`;
                } else if (book.cover_image && book.cover_image.startsWith('data:image')) {
                    coverElement.innerHTML = `<img src="${book.cover_image}" alt="ØºÙ„Ø§Ù Ø§Ù„ÙƒØªØ§Ø¨">`;
                } else {
                    coverElement.innerHTML = `
                        <div style="width: 100%; height: 100%; background: var(--gradient-admin); 
                             display: flex; align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-book" style="font-size: 48px;"></i>
                        </div>
                    `;
                }
                
                // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù
                document.getElementById('adminNotes').value = book.adminNotes || '';
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø©
                document.getElementById('previewModal').style.display = 'flex';
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒØªØ§Ø¨:', error);
                showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒØªØ§Ø¨', 'error');
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        function closePreview() {
            document.getElementById('previewModal').style.display = 'none';
            currentBookId = null;
        }

        // ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØªØ§Ø¨
        function changeStatus(bookId, newStatus, notes = '') {
            try {
                const bookIndex = allBooks.findIndex(b => b.id === bookId);
                if (bookIndex === -1) {
                    showToast('âŒ Ø§Ù„ÙƒØªØ§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                allBooks[bookIndex].status = newStatus;
                allBooks[bookIndex].adminNotes = notes;
                allBooks[bookIndex].reviewedAt = new Date().toISOString();
                
                // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                localStorage.setItem('submittedBooks', JSON.stringify(allBooks));
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø¹Ø±Ø¶
                updateStats();
                filterBooks();
                
                // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
                if (currentBookId === bookId) {
                    closePreview();
                }
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù…Ø­Ù„ÙŠ)
                sendNotificationToUser(allBooks[bookIndex].userId, newStatus, allBooks[bookIndex].title);
                
                showToast(`âœ… ØªÙ… ${getStatusArabic(newStatus)} Ø§Ù„ÙƒØªØ§Ø¨`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØªØ§Ø¨:', error);
                showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©', 'error');
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø­Ø§Ù„Ø©
        function getStatusArabic(status) {
            const statusMap = {
                'pending': 'ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø©',
                'review': 'ÙˆØ¶Ø¹ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
                'approved': 'Ù‚Ø¨ÙˆÙ„',
                'rejected': 'Ø±ÙØ¶'
            };
            return statusMap[status] || 'ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø©';
        }

        // Ù‚Ø¨ÙˆÙ„ Ø§Ù„ÙƒØªØ§Ø¨ Ù…Ù† Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        function approveBook() {
            if (!currentBookId) return;
            const notes = document.getElementById('adminNotes').value;
            changeStatus(currentBookId, 'approved', notes);
        }

        // Ø±ÙØ¶ Ø§Ù„ÙƒØªØ§Ø¨ Ù…Ù† Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        function rejectBook() {
            if (!currentBookId) return;
            const notes = document.getElementById('adminNotes').value;
            changeStatus(currentBookId, 'rejected', notes);
        }

        // ÙˆØ¶Ø¹ Ø§Ù„ÙƒØªØ§Ø¨ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        function markForReview() {
            if (!currentBookId) return;
            const notes = document.getElementById('adminNotes').value;
            changeStatus(currentBookId, 'review', notes);
        }

        // Ù‚Ø¨ÙˆÙ„ Ø³Ø±ÙŠØ¹
        function quickApprove(bookId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù‚Ø¨ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„ÙƒØªØ§Ø¨ØŸ')) {
                changeStatus(bookId, 'approved', 'ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø´Ø±Ù');
            }
        }

        // Ø±ÙØ¶ Ø³Ø±ÙŠØ¹
        function quickReject(bookId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„ÙƒØªØ§Ø¨ØŸ')) {
                changeStatus(bookId, 'rejected', 'ØªÙ… Ø§Ù„Ø±ÙØ¶ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø´Ø±Ù');
            }
        }

        // ÙˆØ¶Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØªØ¨ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
        function markAllForReview() {
            if (allBooks.length === 0) {
                showToast('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØªØ¨ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', 'error');
                return;
            }
            
            if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ ÙˆØ¶Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØªØ¨ (${allBooks.length} ÙƒØªØ§Ø¨) Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŸ`)) {
                allBooks.forEach(book => {
                    if (book.status === 'pending') {
                        book.status = 'review';
                        book.adminNotes = 'ÙˆØ¶Ø¹ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©';
                        book.reviewedAt = new Date().toISOString();
                    }
                });
                
                localStorage.setItem('submittedBooks', JSON.stringify(allBooks));
                updateStats();
                filterBooks();
                showToast(`âœ… ØªÙ… ÙˆØ¶Ø¹ ${allBooks.length} ÙƒØªØ§Ø¨ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©`);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨
        function downloadBook(bookId) {
            try {
                const book = allBooks.find(b => b.id === bookId);
                if (!book || !book.drive_link) {
                    showToast('âŒ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ ØºÙŠØ± Ù…ØªÙˆÙØ±', 'error');
                    return;
                }
                
                // ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
                window.open(book.drive_link, '_blank');
                
                // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
                const stats = JSON.parse(localStorage.getItem('siteStats') || '{}');
                if (!stats.downloads) stats.downloads = {};
                stats.downloads[bookId] = (stats.downloads[bookId] || 0) + 1;
                localStorage.setItem('siteStats', JSON.stringify(stats));
                
                showToast('âœ… Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„...');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨:', error);
                showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„', 'error');
            }
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function sendNotificationToUser(userId, status, bookTitle) {
            try {
                // Ø­ÙØ¸ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const userNotifications = JSON.parse(localStorage.getItem('userNotifications') || '{}');
                if (!userNotifications[userId]) {
                    userNotifications[userId] = [];
                }
                
                const statusText = {
                    'approved': 'Ù…Ù‚Ø¨ÙˆÙ„',
                    'rejected': 'Ù…Ø±ÙÙˆØ¶',
                    'review': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'
                }[status] || 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«';
                
                userNotifications[userId].push({
                    id: 'notification_' + Date.now(),
                    type: 'book_status',
                    title: `ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØªØ§Ø¨: ${bookTitle}`,
                    message: `ØªÙ… ${statusText} ÙƒØªØ§Ø¨Ùƒ "${bookTitle}"`,
                    status: status,
                    timestamp: new Date().toISOString(),
                    read: false
                });
                
                // Ø­ÙØ¸ ÙÙ‚Ø· Ø¢Ø®Ø± 50 Ø¥Ø´Ø¹Ø§Ø±
                userNotifications[userId] = userNotifications[userId].slice(-50);
                
                localStorage.setItem('userNotifications', JSON.stringify(userNotifications));
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:', error);
            }
        }

        // ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ¨
        function exportBooksData() {
            try {
                const exportData = {
                    books: allBooks,
                    exportDate: new Date().toISOString(),
                    totalBooks: allBooks.length,
                    stats: {
                        pending: allBooks.filter(b => b.status === 'pending').length,
                        approved: allBooks.filter(b => b.status === 'approved').length,
                        review: allBooks.filter(b => b.status === 'review').length,
                        rejected: allBooks.filter(b => b.status === 'rejected').length
                    }
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileName = `admin_books_${new Date().toISOString().slice(0,10)}.json`;
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileName);
                linkElement.click();
                
                showToast('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ¨ Ø¨Ù†Ø¬Ø§Ø­');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±', 'error');
            }
        }

        // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function clearAllData() {
            if (allBooks.length === 0) {
                showToast('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø³Ø­', 'error');
                return;
            }
            
            if (confirm(`âš ï¸ ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØªØ¨ (${allBooks.length} ÙƒØªØ§Ø¨) Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ`)) {
                localStorage.removeItem('submittedBooks');
                allBooks = [];
                updateStats();
                filterBooks();
                showToast('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function refreshData() {
            const btn = event?.target?.closest('.btn');
            if (btn) {
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...';
                
                setTimeout(() => {
                    loadBooks();
                    btn.innerHTML = originalHTML;
                    showToast('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                }, 1000);
            } else {
                loadBooks();
                showToast('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ø£Ùˆ Ø®Ø·Ø£
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'success-toast';
            toast.style.background = type === 'error' ? 
                'var(--gradient-rejected)' : 
                'var(--gradient-approved)';
            
            toast.innerHTML = `
                <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}" style="font-size: 20px;"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
        function connectToStudentPage() {
            console.log('ğŸ”— ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…ØªØµÙ„Ø© Ø¨ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
            console.log('ğŸ“– ÙŠÙ…ÙƒÙ† Ù„Ù„Ø·Ù„Ø§Ø¨ Ø±ÙØ¹ Ø§Ù„ÙƒØªØ¨ Ù…Ù†: student_profile.html');
            console.log('ğŸ‘ï¸ Ø§Ù„ÙƒØªØ¨ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹');
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§ØªØµØ§Ù„
        connectToStudentPage();
    </script>
</body>
</html>